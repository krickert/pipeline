
tika-input-doc-018*…êsource-code/PipelineConfigService.java source-code/PipelineConfigService.javapackageÂ com.rokkon.search.config.pipeline.service; importÂ com.fasterxml.jackson.core.JsonProcessingException; importÂ com.fasterxml.jackson.databind.JsonNode; importÂ com.fasterxml.jackson.databind.ObjectMapper; importÂ com.fasterxml.jackson.databind.node.ObjectNode; importÂ com.rokkon.search.config.pipeline.model.*; importÂ com.rokkon.search.config.pipeline.service.events.ConfigChangeEvent; importÂ com.rokkon.search.config.pipeline.service.validation.ValidationResult; importÂ io.quarkus.runtime.annotations.RegisterForReflection; importÂ org.slf4j.Logger; importÂ org.slf4j.LoggerFactory; importÂ jakarta.enterprise.context.ApplicationScoped; importÂ jakarta.enterprise.event.Event; importÂ jakarta.inject.Inject; importÂ java.net.URI; importÂ java.net.http.HttpClient; importÂ java.net.http.HttpRequest; importÂ java.net.http.HttpResponse; importÂ java.nio.charset.StandardCharsets; importÂ java.security.MessageDigest; importÂ java.security.NoSuchAlgorithmException; importÂ java.time.Duration; importÂ java.util.*; importÂ java.util.concurrent.CompletableFuture; importÂ java.util.concurrent.CompletionStage; /** Â *Â MainÂ serviceÂ forÂ CRUDÂ operationsÂ onÂ pipelineÂ configurations. Â *Â ImplementsÂ per-pipelineÂ storageÂ inÂ ConsulÂ withÂ comprehensiveÂ validation. Â */ @ApplicationScoped @RegisterForReflection publicÂ classÂ PipelineConfigServiceÂ { Â Â Â Â  Â Â Â Â privateÂ staticÂ finalÂ LoggerÂ LOGÂ =Â LoggerFactory.getLogger(PipelineConfigService.class); Â Â Â Â  Â Â Â Â privateÂ finalÂ ObjectMapperÂ objectMapper; Â Â Â Â privateÂ finalÂ ConfigValidationServiceÂ validationService; Â Â Â Â privateÂ finalÂ SchemaValidationServiceÂ schemaValidationService; Â Â Â Â privateÂ finalÂ Event<ConfigChangeEvent>Â configChangeEvent; Â Â Â Â privateÂ finalÂ HttpClientÂ httpClient; Â Â Â Â  Â Â Â Â //Â ConsulÂ configuration Â Â Â Â privateÂ finalÂ StringÂ consulHost; Â Â Â Â privateÂ finalÂ StringÂ consulPort; Â Â Â Â privateÂ finalÂ StringÂ consulBaseUrl; Â Â Â Â  Â Â Â Â @Inject Â Â Â Â publicÂ PipelineConfigService( Â Â Â Â Â Â Â Â Â Â Â Â ObjectMapperÂ objectMapper, Â Â Â Â Â Â Â Â Â Â Â Â ConfigValidationServiceÂ validationService, Â Â Â Â Â Â Â Â Â Â Â Â SchemaValidationServiceÂ schemaValidationService, Â Â Â Â Â Â Â Â Â Â Â Â Event<ConfigChangeEvent>Â configChangeEvent, Â Â Â Â Â Â Â Â Â Â Â Â @org.eclipse.microprofile.config.inject.ConfigProperty(nameÂ =Â "quarkus.consul-config.agent.host-port")Â  Â Â Â Â Â Â Â Â Â Â Â Â Optional<String>Â consulConfig)Â { Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â this.objectMapperÂ =Â objectMapper; Â Â Â Â Â Â Â Â this.validationServiceÂ =Â validationService; Â Â Â Â Â Â Â Â this.schemaValidationServiceÂ =Â schemaValidationService; Â Â Â Â Â Â Â Â this.configChangeEventÂ =Â configChangeEvent; Â Â Â Â Â Â Â Â this.httpClientÂ =Â HttpClient.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .connectTimeout(Duration.ofSeconds(10)) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â ParseÂ ConsulÂ configuration Â Â Â Â Â Â Â Â ifÂ (consulConfig.isPresent())Â { Â Â Â Â Â Â Â Â Â Â Â Â String[]Â hostPortÂ =Â consulConfig.get().split(":"); Â Â Â Â Â Â Â Â Â Â Â Â this.consulHostÂ =Â hostPort[0]; Â Â Â Â Â Â Â Â Â Â Â Â this.consulPortÂ =Â hostPort.lengthÂ >Â 1Â ?Â hostPort[1]Â :Â "8500"; Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â this.consulHostÂ =Â "localhost"; Â Â Â Â Â Â Â Â Â Â Â Â this.consulPortÂ =Â "8500"; Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â this.consulBaseUrlÂ =Â "http://"Â +Â consulHostÂ +Â ":"Â +Â consulPort; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â LOG.info("PipelineConfigServiceÂ initializedÂ withÂ ConsulÂ at:Â {}",Â consulBaseUrl); Â Â Â Â } Â Â Â Â  Â Â Â Â /** Â Â Â Â Â *Â CreatesÂ aÂ newÂ pipelineÂ inÂ theÂ specifiedÂ cluster. Â Â Â Â Â */ Â Â Â Â publicÂ CompletionStage<ValidationResult>Â createPipeline(StringÂ clusterName,Â StringÂ pipelineId,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PipelineConfigÂ config,Â StringÂ initiatedBy)Â { Â Â Â Â Â Â Â Â LOG.info("CreatingÂ pipelineÂ '{}'Â inÂ clusterÂ '{}'",Â pipelineId,Â clusterName); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â returnÂ validatePipelineForCreation(clusterName,Â pipelineId,Â config) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .thenCompose(validationResultÂ ->Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (!validationResult.valid())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ CompletableFuture.completedFuture(validationResult); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ storePipelineInConsul(clusterName,Â pipelineId,Â config) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .thenApply(successÂ ->Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (success)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â FireÂ creationÂ event Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â configChangeEvent.fire(ConfigChangeEvent.pipelineCreated( Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â clusterName,Â pipelineId,Â config,Â initiatedBy)); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.info("SuccessfullyÂ createdÂ pipelineÂ '{}'Â inÂ clusterÂ '{}'",Â pipelineId,Â clusterName); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ ValidationResult.success(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ ValidationResult.failure("FailedÂ toÂ storeÂ pipelineÂ inÂ Consul"); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }); Â Â Â Â } Â Â Â Â  Â Â Â Â /** Â Â Â Â Â *Â UpdatesÂ anÂ existingÂ pipeline. Â Â Â Â Â */ Â Â Â Â publicÂ CompletionStage<ValidationResult>Â updatePipeline(StringÂ clusterName,Â StringÂ pipelineId, Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PipelineConfigÂ newConfig,Â StringÂ initiatedBy)Â { Â Â Â Â Â Â Â Â LOG.info("UpdatingÂ pipelineÂ '{}'Â inÂ clusterÂ '{}'",Â pipelineId,Â clusterName); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â returnÂ getPipeline(clusterName,Â pipelineId) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .thenCompose(oldConfigÂ ->Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (oldConfig.isEmpty())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ CompletableFuture.completedFuture( Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ValidationResult.failure("PipelineÂ '"Â +Â pipelineIdÂ +Â "'Â notÂ found")); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ validatePipelineForUpdate(clusterName,Â pipelineId,Â newConfig,Â oldConfig.get()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .thenCompose(validationResultÂ ->Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (!validationResult.valid())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ CompletableFuture.completedFuture(validationResult); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ storePipelineInConsul(clusterName,Â pipelineId,Â newConfig) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .thenApply(successÂ ->Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (success)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â FireÂ updateÂ event Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â configChangeEvent.fire(ConfigChangeEvent.pipelineUpdated( Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â clusterName,Â pipelineId,Â newConfig,Â oldConfig.get(),Â initiatedBy)); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.info("SuccessfullyÂ updatedÂ pipelineÂ '{}'Â inÂ clusterÂ '{}'",Â pipelineId,Â clusterName); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ ValidationResult.success(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ ValidationResult.failure("FailedÂ toÂ updateÂ pipelineÂ inÂ Consul"); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }); Â Â Â Â } Â Â Â Â  Â Â Â Â /** Â Â Â Â Â *Â DeletesÂ aÂ pipeline. Â Â Â Â Â */ Â Â Â Â publicÂ CompletionStage<ValidationResult>Â deletePipeline(StringÂ clusterName,Â StringÂ pipelineId,Â StringÂ initiatedBy)Â { Â Â Â Â Â Â Â Â LOG.info("DeletingÂ pipelineÂ '{}'Â fromÂ clusterÂ '{}'",Â pipelineId,Â clusterName); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â returnÂ getPipeline(clusterName,Â pipelineId) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .thenCompose(oldConfigÂ ->Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (oldConfig.isEmpty())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ CompletableFuture.completedFuture( Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ValidationResult.failure("PipelineÂ '"Â +Â pipelineIdÂ +Â "'Â notÂ found")); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ deletePipelineFromConsul(clusterName,Â pipelineId) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .thenApply(successÂ ->Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (success)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â FireÂ deletionÂ event Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â configChangeEvent.fire(ConfigChangeEvent.pipelineDeleted( Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â clusterName,Â pipelineId,Â oldConfig.get(),Â initiatedBy)); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.info("SuccessfullyÂ deletedÂ pipelineÂ '{}'Â fromÂ clusterÂ '{}'",Â pipelineId,Â clusterName); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ ValidationResult.success(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ ValidationResult.failure("FailedÂ toÂ deleteÂ pipelineÂ fromÂ Consul"); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }); Â Â Â Â } Â Â Â Â  Â Â Â Â /** Â Â Â Â Â *Â GetsÂ aÂ pipelineÂ configuration. Â Â Â Â Â */ Â Â Â Â publicÂ CompletionStage<Optional<PipelineConfig>>Â getPipeline(StringÂ clusterName,Â StringÂ pipelineId)Â { Â Â Â Â Â Â Â Â returnÂ retrievePipelineFromConsul(clusterName,Â pipelineId); Â Â Â Â } Â Â Â Â  Â Â Â Â /** Â Â Â Â Â *Â ListsÂ allÂ pipelinesÂ inÂ aÂ cluster. Â Â Â Â Â */ Â Â Â Â publicÂ CompletionStage<Map<String,Â PipelineConfig>>Â listPipelines(StringÂ clusterName)Â { Â Â Â Â Â Â Â Â returnÂ listPipelinesFromConsul(clusterName); Â Â Â Â } Â Â Â Â  Â Â Â Â /** Â Â Â Â Â *Â AnalyzesÂ theÂ impactÂ ofÂ deletingÂ aÂ pipelineÂ orÂ module. Â Â Â Â Â */ Â Â Â Â publicÂ CompletionStage<DependencyImpactAnalysis>Â analyzeDeletionImpact(StringÂ clusterName,Â StringÂ targetId,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â DependencyTypeÂ targetType)Â { Â Â Â Â Â Â Â Â LOG.info("AnalyzingÂ deletionÂ impactÂ forÂ {}Â '{}'Â inÂ clusterÂ '{}'",Â targetType,Â targetId,Â clusterName); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â returnÂ listPipelines(clusterName) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .thenApply(pipelinesÂ ->Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â List<String>Â affectedPipelinesÂ =Â newÂ ArrayList<>(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â List<String>Â orphanedTopicsÂ =Â newÂ ArrayList<>(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â List<String>Â orphanedServicesÂ =Â newÂ ArrayList<>(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â forÂ (varÂ entryÂ :Â pipelines.entrySet())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ pipelineIdÂ =Â entry.getKey(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PipelineConfigÂ pipelineÂ =Â entry.getValue(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (targetTypeÂ ==Â DependencyType.PIPELINEÂ &&Â targetId.equals(pipelineId))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â continue;Â //Â SkipÂ theÂ targetÂ pipelineÂ itself Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ isAffectedÂ =Â checkPipelineAffectedByDeletion(pipeline,Â targetId,Â targetType); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (isAffected)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â affectedPipelines.add(pipelineId); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ DependencyImpactAnalysis( Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â targetId, Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â targetType, Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â affectedPipelines, Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â orphanedTopics, Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â orphanedServices, Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â affectedPipelines.isEmpty() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }); Â Â Â Â } Â Â Â Â  Â Â Â Â /** Â Â Â Â Â *Â CanonicalizesÂ JSONÂ forÂ consistentÂ orderingÂ andÂ hashing. Â Â Â Â Â *Â BasedÂ onÂ theÂ patternÂ fromÂ theÂ oldÂ ConsulModuleRegistrationService. Â Â Â Â Â */ Â Â Â Â publicÂ StringÂ canonicalizeJson(StringÂ jsonString)Â throwsÂ JsonProcessingExceptionÂ { Â Â Â Â Â Â Â Â JsonNodeÂ nodeÂ =Â objectMapper.readTree(jsonString); Â Â Â Â Â Â Â Â returnÂ canonicalizeJsonNode(node); Â Â Â Â } Â Â Â Â  Â Â Â Â privateÂ StringÂ canonicalizeJsonNode(JsonNodeÂ node)Â throwsÂ JsonProcessingExceptionÂ { Â Â Â Â Â Â Â Â ifÂ (node.isObject())Â { Â Â Â Â Â Â Â Â Â Â Â Â ObjectNodeÂ sortedNodeÂ =Â objectMapper.createObjectNode(); Â Â Â Â Â Â Â Â Â Â Â Â List<String>Â fieldNamesÂ =Â newÂ ArrayList<>(); Â Â Â Â Â Â Â Â Â Â Â Â node.fieldNames().forEachRemaining(fieldNames::add); Â Â Â Â Â Â Â Â Â Â Â Â Collections.sort(fieldNames); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â forÂ (StringÂ fieldNameÂ :Â fieldNames)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â JsonNodeÂ childNodeÂ =Â node.get(fieldName); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (childNode.isObject()Â ||Â childNode.isArray())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sortedNode.set(fieldName,Â objectMapper.readTree(canonicalizeJsonNode(childNode))); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sortedNode.set(fieldName,Â childNode); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â returnÂ objectMapper.writeValueAsString(sortedNode); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â returnÂ objectMapper.writeValueAsString(node); Â Â Â Â } Â Â Â Â  Â Â Â Â /** Â Â Â Â Â *Â GeneratesÂ anÂ MD5Â digestÂ forÂ configurationÂ versioning. Â Â Â Â Â */ Â Â Â Â publicÂ StringÂ generateConfigDigest(StringÂ configJson)Â throwsÂ NoSuchAlgorithmExceptionÂ { Â Â Â Â Â Â Â Â MessageDigestÂ mdÂ =Â MessageDigest.getInstance("MD5"); Â Â Â Â Â Â Â Â byte[]Â digestÂ =Â md.digest(configJson.getBytes(StandardCharsets.UTF_8)); Â Â Â Â Â Â Â Â returnÂ Base64.getEncoder().encodeToString(digest); Â Â Â Â } Â Â Â Â  Â Â Â Â //Â PrivateÂ helperÂ methods Â Â Â Â  Â Â Â Â privateÂ CompletionStage<ValidationResult>Â validatePipelineForCreation(StringÂ clusterName,Â StringÂ pipelineId,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PipelineConfigÂ config)Â { Â Â Â Â Â Â Â Â returnÂ validationService.validatePipelineStructure(pipelineId,Â config) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .thenCompose(structuralResultÂ ->Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (!structuralResult.valid())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ CompletableFuture.completedFuture(structuralResult); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â JSONÂ SchemaÂ validation Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ configJsonÂ =Â objectMapper.writeValueAsString(config); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ schemaValidationService.validatePipelineStepConfig(configJson) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .thenApply(schemaResultÂ ->Â structuralResult.combine(schemaResult)); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (JsonProcessingExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ CompletableFuture.completedFuture( Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ValidationResult.failure("FailedÂ toÂ serializeÂ pipelineÂ config:Â "Â +Â e.getMessage())); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }); Â Â Â Â } Â Â Â Â  Â Â Â Â privateÂ CompletionStage<ValidationResult>Â validatePipelineForUpdate(StringÂ clusterName,Â StringÂ pipelineId, Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PipelineConfigÂ newConfig,Â PipelineConfigÂ oldConfig)Â { Â Â Â Â Â Â Â Â //Â SameÂ validationÂ asÂ creationÂ forÂ now,Â butÂ couldÂ addÂ update-specificÂ checks Â Â Â Â Â Â Â Â returnÂ validatePipelineForCreation(clusterName,Â pipelineId,Â newConfig); Â Â Â Â } Â Â Â Â  Â Â Â Â privateÂ CompletionStage<Boolean>Â storePipelineInConsul(StringÂ clusterName,Â StringÂ pipelineId,Â PipelineConfigÂ config)Â { Â Â Â Â Â Â Â Â returnÂ CompletableFuture.supplyAsync(()Â ->Â { Â Â Â Â Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ configJsonÂ =Â canonicalizeJson(objectMapper.writeValueAsString(config)); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ consulKeyÂ =Â buildPipelineKey(clusterName,Â pipelineId); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â HttpRequestÂ requestÂ =Â HttpRequest.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .uri(URI.create(consulBaseUrlÂ +Â "/v1/kv/"Â +Â consulKey)) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .PUT(HttpRequest.BodyPublishers.ofString(configJson)) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â HttpResponse<String>Â responseÂ =Â httpClient.send(request,Â HttpResponse.BodyHandlers.ofString()); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ successÂ =Â response.statusCode()Â ==Â 200; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (success)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.debug("StoredÂ pipelineÂ '{}'Â inÂ ConsulÂ atÂ keyÂ '{}'",Â pipelineId,Â consulKey); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.error("FailedÂ toÂ storeÂ pipelineÂ '{}'Â inÂ Consul.Â Status:Â {},Â Body:Â {}",Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â pipelineId,Â response.statusCode(),Â response.body()); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ success; Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.error("ErrorÂ storingÂ pipelineÂ '{}'Â inÂ Consul:Â {}",Â pipelineId,Â e.getMessage(),Â e); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false; Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â }); Â Â Â Â } Â Â Â Â  Â Â Â Â privateÂ CompletionStage<Optional<PipelineConfig>>Â retrievePipelineFromConsul(StringÂ clusterName,Â StringÂ pipelineId)Â { Â Â Â Â Â Â Â Â returnÂ CompletableFuture.supplyAsync(()Â ->Â { Â Â Â Â Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ consulKeyÂ =Â buildPipelineKey(clusterName,Â pipelineId); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â HttpRequestÂ requestÂ =Â HttpRequest.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .uri(URI.create(consulBaseUrlÂ +Â "/v1/kv/"Â +Â consulKeyÂ +Â "?raw")) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .GET() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â HttpResponse<String>Â responseÂ =Â httpClient.send(request,Â HttpResponse.BodyHandlers.ofString()); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (response.statusCode()Â ==Â 200)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PipelineConfigÂ configÂ =Â objectMapper.readValue(response.body(),Â PipelineConfig.class); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ Optional.of(config); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ ifÂ (response.statusCode()Â ==Â 404)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ Optional.<PipelineConfig>empty(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.error("FailedÂ toÂ retrieveÂ pipelineÂ '{}'Â fromÂ Consul.Â Status:Â {}",Â pipelineId,Â response.statusCode()); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ Optional.<PipelineConfig>empty(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.error("ErrorÂ retrievingÂ pipelineÂ '{}'Â fromÂ Consul:Â {}",Â pipelineId,Â e.getMessage(),Â e); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ Optional.<PipelineConfig>empty(); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â }); Â Â Â Â } Â Â Â Â  Â Â Â Â privateÂ CompletionStage<Boolean>Â deletePipelineFromConsul(StringÂ clusterName,Â StringÂ pipelineId)Â { Â Â Â Â Â Â Â Â returnÂ CompletableFuture.supplyAsync(()Â ->Â { Â Â Â Â Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ consulKeyÂ =Â buildPipelineKey(clusterName,Â pipelineId); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â HttpRequestÂ requestÂ =Â HttpRequest.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .uri(URI.create(consulBaseUrlÂ +Â "/v1/kv/"Â +Â consulKey)) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .DELETE() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â HttpResponse<String>Â responseÂ =Â httpClient.send(request,Â HttpResponse.BodyHandlers.ofString()); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ successÂ =Â response.statusCode()Â ==Â 200; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (success)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.debug("DeletedÂ pipelineÂ '{}'Â fromÂ ConsulÂ atÂ keyÂ '{}'",Â pipelineId,Â consulKey); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.error("FailedÂ toÂ deleteÂ pipelineÂ '{}'Â fromÂ Consul.Â Status:Â {}",Â pipelineId,Â response.statusCode()); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ success; Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.error("ErrorÂ deletingÂ pipelineÂ '{}'Â fromÂ Consul:Â {}",Â pipelineId,Â e.getMessage(),Â e); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false; Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â }); Â Â Â Â } Â Â Â Â  Â Â Â Â privateÂ CompletionStage<Map<String,Â PipelineConfig>>Â listPipelinesFromConsul(StringÂ clusterName)Â { Â Â Â Â Â Â Â Â returnÂ CompletableFuture.supplyAsync(()Â ->Â { Â Â Â Â Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ consulPrefixÂ =Â buildClusterPrefix(clusterName)Â +Â "pipelines/"; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â HttpRequestÂ requestÂ =Â HttpRequest.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .uri(URI.create(consulBaseUrlÂ +Â "/v1/kv/"Â +Â consulPrefixÂ +Â "?keys")) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .GET() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â HttpResponse<String>Â responseÂ =Â httpClient.send(request,Â HttpResponse.BodyHandlers.ofString()); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (response.statusCode()Â ==Â 200)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String[]Â keysÂ =Â objectMapper.readValue(response.body(),Â String[].class); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Map<String,Â PipelineConfig>Â pipelinesÂ =Â newÂ HashMap<>(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â forÂ (StringÂ keyÂ :Â keys)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ pipelineIdÂ =Â extractPipelineIdFromKey(key); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (pipelineIdÂ !=Â null)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Optional<PipelineConfig>Â configÂ =Â retrievePipelineFromConsul(clusterName,Â pipelineId).toCompletableFuture().join(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â config.ifPresent(cÂ ->Â pipelines.put(pipelineId,Â c)); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ pipelines; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ ifÂ (response.statusCode()Â ==Â 404)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ HashMap<String,Â PipelineConfig>(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.error("FailedÂ toÂ listÂ pipelinesÂ fromÂ Consul.Â Status:Â {}",Â response.statusCode()); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ HashMap<String,Â PipelineConfig>(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.error("ErrorÂ listingÂ pipelinesÂ fromÂ Consul:Â {}",Â e.getMessage(),Â e); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ HashMap<String,Â PipelineConfig>(); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â }); Â Â Â Â } Â Â Â Â  Â Â Â Â privateÂ booleanÂ checkPipelineAffectedByDeletion(PipelineConfigÂ pipeline,Â StringÂ targetId,Â DependencyTypeÂ targetType)Â { Â Â Â Â Â Â Â Â ifÂ (pipeline.pipelineSteps()Â ==Â null)Â { Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false; Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â forÂ (PipelineStepConfigÂ stepÂ :Â pipeline.pipelineSteps().values())Â { Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (targetTypeÂ ==Â DependencyType.MODULEÂ &&Â step.processorInfo()Â !=Â nullÂ &&Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â targetId.equals(step.processorInfo().grpcServiceName()))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ true; Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (step.outputs()Â !=Â null)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â forÂ (varÂ outputÂ :Â step.outputs().values())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (output.grpcTransport()Â !=Â nullÂ &&Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â targetId.equals(output.grpcTransport().serviceName()))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ true; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â returnÂ false; Â Â Â Â } Â Â Â Â  Â Â Â Â privateÂ StringÂ buildPipelineKey(StringÂ clusterName,Â StringÂ pipelineId)Â { Â Â Â Â Â Â Â Â returnÂ buildClusterPrefix(clusterName)Â +Â "pipelines/"Â +Â pipelineIdÂ +Â "/config"; Â Â Â Â } Â Â Â Â  Â Â Â Â privateÂ StringÂ buildClusterPrefix(StringÂ clusterName)Â { Â Â Â Â Â Â Â Â returnÂ "rokkon-clusters/"Â +Â clusterNameÂ +Â "/"; Â Â Â Â } Â Â Â Â  Â Â Â Â privateÂ StringÂ extractPipelineIdFromKey(StringÂ key)Â { Â Â Â Â Â Â Â Â //Â ExtractÂ from:Â rokkon-clusters/{cluster}/pipelines/{pipelineId}/config Â Â Â Â Â Â Â Â String[]Â partsÂ =Â key.split("/"); Â Â Â Â Â Â Â Â ifÂ (parts.lengthÂ >=Â 4Â &&Â "pipelines".equals(parts[2]))Â { Â Â Â Â Â Â Â Â Â Â Â Â returnÂ parts[3]; Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â returnÂ null; Â Â Â Â } Â Â Â Â  Â Â Â Â //Â SupportingÂ classes Â Â Â Â  Â Â Â Â publicÂ recordÂ DependencyImpactAnalysis( Â Â Â Â Â Â Â Â Â Â Â Â StringÂ targetId, Â Â Â Â Â Â Â Â Â Â Â Â DependencyTypeÂ targetType, Â Â Â Â Â Â Â Â Â Â Â Â List<String>Â affectedPipelines, Â Â Â Â Â Â Â Â Â Â Â Â List<String>Â orphanedTopics, Â Â Â Â Â Â Â Â Â Â Â Â List<String>Â orphanedServices, Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ canSafelyDelete Â Â Â Â )Â {} Â Â Â Â  Â Â Â Â publicÂ enumÂ DependencyTypeÂ { Â Â Â Â Â Â Â Â PIPELINE,Â MODULE,Â SCHEMA Â Â Â Â } }bÎ

loc472
6
x_tika_encodingdetectorUniversalEncodingDetector
q
x_tika_parsed_by_full_setTRorg.apache.tika.parser.DefaultParser; org.apache.tika.parser.code.SourceCodeParser
$
content_typetext/x-java-source
 
content_encoding
ISO-8859-1
'
x_tika_detectedencoding
ISO-8859-1
8
resourcename(&source-code/PipelineConfigService.java
h
x_tika_parsed_byTRorg.apache.tika.parser.DefaultParser; org.apache.tika.parser.code.SourceCodeParserjˆü
$5fef66d2-b1f5-48ea-bfca-cbc46d6f808cbodystandard_500_50*chunks_chunker_standard_500_502è	
?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_0Æ
ìsource - code / PipelineConfigService. java source - code / PipelineConfigService. javapackage com. rokkon. search. config. pipeline. service; import com. fasterxml. jackson. core. JsonProcessingException; import com. fasterxml. jackson. databind. JsonNode; import com. fasterxml. jackson. databind. ObjectMapper; import com. fasterxml. jackson. databind. node. ObjectNode; import com. rokkon. search. config. pipeline. model. *; import com. rokkon. search. config. pipeline. service. events.?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_0  (¿:standard_500_50" 
average_word_length	i o@"$
potential_heading_score	        "
sentence_count	     €B@"$
alphanumeric_percentage	–!Žuqé?"h
punctuation_countsR*P

*	      ð?

;	      @

-	       @

.	     €B@

/	       @"!
uppercase_percentage	¬Zd;Ÿ?""
whitespace_percentage	XÊ2Ä±.¾?"
list_item_indicator  "

word_count	     €Y@"$
average_sentence_length	çŒ(í@"
vocabulary_density	Å °rh‘Ñ?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk "
character_count	     À~@"
relative_position	        2¿	
?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_1Ë
ðcom. rokkon. search. config. pipeline. service. events. ConfigChangeEvent; import com. rokkon. search. config. pipeline. service. validation. ValidationResult; import io. quarkus. runtime. annotations. RegisterForReflection; import org. slf 4 j. Logger; import org. slf 4 j. LoggerFactory; import jakarta. enterprise. context. ApplicationScoped; import jakarta. enterprise. event. Event; import jakarta. inject. Inject; import java. net. URI; import java. net. http. HttpClient; import java. net.?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_1 (Ö:standard_500_50" 
average_word_length	ÙÎ÷Sã%@"$
potential_heading_score	        "
sentence_count	     €B@"$
alphanumeric_percentage	ðHPüé?"8
punctuation_counts"* 

;	      $@

.	     €B@"!
uppercase_percentage	à¾œ3¢¤?""
whitespace_percentage	`åÐ"Ûù¾?"
list_item_indicator  "

word_count	      [@"$
average_sentence_length	îZB>èY@"
vocabulary_density	°çŒ(íÕ?"
digit_percentage	ü©ñÒMbp?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      @"
relative_position	%ušž?2ñ	
?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_2Í
òimport java. net. http. HttpClient; import java. net. http. HttpRequest; import java. net. http. HttpResponse; import java. nio. charset. StandardCharsets; import java. security. MessageDigest; import java. security. NoSuchAlgorithmException; import java. time. Duration; import java. util. *; import java. util. concurrent. CompletableFuture; import java. util. concurrent. CompletionStage; / ** * Main service for CRUD operations on pipeline configurations. * Implements per - pipeline storage in?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_2 ¦(ü	:standard_500_50" 
average_word_length	Ñ‘\þC:@"$
potential_heading_score	š™™™™™É?"
sentence_count	      <@"$
alphanumeric_percentage	Þ	Šé?"h
punctuation_countsR*P

*	      @

;	      $@

-	      ð?

.	      ;@

/	      ð?"!
uppercase_percentage	Ýµ„|Ð³©?""
whitespace_percentage	þÔxé&1À?"
list_item_indicator  "

word_count	     @Y@"$
average_sentence_length	z6«>WÛ@"
vocabulary_density	S–!Žuq×?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      @"
relative_position	%uš®?2æ

?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_3Ï
ô. * Implements per - pipeline storage in Consul with comprehensive validation. * / @ ApplicationScoped @ RegisterForReflection public class PipelineConfigService {private static final Logger LOG = LoggerFactory. getLogger (PipelineConfigService. class); private final ObjectMapper objectMapper; private final ConfigValidationService validationService; private final SchemaValidationService schemaValidationService; private final Event < ConfigChangeEvent > configChangeEvent; private final HttpClient?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_3 Ö	(ã:standard_500_50" 
average_word_length	      @"$
potential_heading_score	š™™™™™É?"
sentence_count	      @"$
alphanumeric_percentage	‡ÙÎ÷Së?"Ú
punctuation_countsÃ*À

@	       @

(	      ð?

)	      ð?

*	       @

{	      ð?

;	      @

<	      ð?

-	      ð?

=	      ð?

.	      @

>	      ð?

/	      ð?"!
uppercase_percentage	{®Gáz´?""
whitespace_percentage	9´Èv¾Ÿº?"
list_item_indicator  "

word_count	      P@"$
average_sentence_length	š™™™™™)@"
vocabulary_density	9ÖÅm4€å?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     @@"
relative_position	Ü×sF”¶?2Õ

?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_4Î
ó> configChangeEvent; private final HttpClient httpClient; // Consul configuration private final String consulHost; private final String consulPort; private final String consulBaseUrl; @ Inject public PipelineConfigService (ObjectMapper objectMapper, ConfigValidationService validationService, SchemaValidationService schemaValidationService, Event < ConfigChangeEvent > configChangeEvent, @ org. eclipse. microprofile. config. inject. ConfigProperty (name = " quarkus. consul - config. agent. host -?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_4 ³(õ:standard_500_50" 
average_word_length	÷_˜LÕ@"$
potential_heading_score	        "
sentence_count	      "@"$
alphanumeric_percentage	çŒ(í¾ê?"Ê
punctuation_counts³*°

@	       @

"	      ð?

(	       @

;	      @

,	      @

<	      ð?

=	      ð?

-	       @

>	       @

.	       @

/	       @"!
uppercase_percentage	œ3¢´7ø²?""
whitespace_percentage	[B>èÙ¬º?"
list_item_indicator  "

word_count	      R@"$
average_sentence_length	       @"
vocabulary_density	<½R–!Žã?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     0@"
relative_position	%uš¾?2…
?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_5Î
ó(name = " quarkus. consul - config. agent. host - port ") Optional < String > consulConfig) {this. objectMapper = objectMapper; this. validationService = validationService; this. schemaValidationService = schemaValidationService; this. configChangeEvent = configChangeEvent; this. httpClient = HttpClient. newBuilder (). connectTimeout (Duration. ofSeconds (10 )). build (); // Parse Consul configuration if (consulConfig. isPresent ()) {String [] hostPort = consulConfig. get (). split (": "); this?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_5 Ì(¯:standard_500_50" 
average_word_length	;M„@"$
potential_heading_score	š™™™™™É?"
sentence_count	      0@"$
alphanumeric_percentage	ìQ¸…ëç?"ú
punctuation_countsã*à

"	      @

(	      "@

)	      $@

-	       @

.	      .@

/	       @

:	      ð?

{	       @

;	      @

[	      ð?

<	      ð?

=	      @

]	      ð?

>	      ð?"!
uppercase_percentage	:’ËH¿­?""
whitespace_percentage	•Ô	h"lÀ?"
list_item_indicator  "

word_count	     €Y@"$
average_sentence_length	     €@"
vocabulary_density	w¾Ÿ/ÝÜ?"
digit_percentage	ü©ñÒMbp?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     0@"
relative_position	Àìž<,ÔÂ?2Æ
?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_6Ï
ô= consulConfig. get (). split (": "); this. consulHost = hostPort [0]; this. consulPort = hostPort. length > 1? hostPort [1]: " 8500 ";} else {this. consulHost = " localhost "; this. consulPort = " 8500 ";} this. consulBaseUrl = " http: // " + consulHost + ": " + consulPort; LOG. info (" PipelineConfigService initialized with Consul at: {} ", consulBaseUrl);} / ** * Creates a new pipeline in the specified cluster. * / public CompletionStage < ValidationResult > createPipeline (String clusterName?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_6 ÿ(Ë:standard_500_50" 
average_word_length	q¬‹Ûh@"$
potential_heading_score	š™™™™™É?"
sentence_count	      &@"$
alphanumeric_percentage	ÁÊ¡E¶óå?"º
punctuation_counts£* 

"	      ,@

(	      @

)	      @

*	      @

+	      @

,	      ð?

.	      $@

/	      @

:	      @

;	      @

[	       @

{	       @

<	      ð?

=	      @

]	       @

}	      @

>	       @

?	      ð?"!
uppercase_percentage	V-²­?""
whitespace_percentage	Ë¡E¶óýÄ?"
list_item_indicator  "

word_count	     €^@"$
average_sentence_length	­iÞqŠ.&@"
vocabulary_density	ÇK7‰A`Ý?"
digit_percentage	ºI+‡–?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     @@"
relative_position	d;ßO—Æ?2ô

?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_7Í
ò> createPipeline (String clusterName, String pipelineId, PipelineConfig config, String initiatedBy) {LOG. info (" Creating pipeline ' {} ' in cluster ' {} ' ", pipelineId, clusterName); return validatePipelineForCreation (clusterName, pipelineId, config). thenCompose (validationResult - > {if (! validationResult. valid ()) {return CompletableFuture. completedFuture (validationResult);} return storePipelineInConsul (clusterName, pipelineId, config). thenApply (success - > {if (success) {// Fire?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_7 ©(º :standard_500_50" 
average_word_length	™»–:@"$
potential_heading_score	š™™™™™É?"
sentence_count	      @"$
alphanumeric_percentage	[B>èÙ¬è?"ê
punctuation_countsÓ*Ð

!	      ð?

"	       @

'	      @

(	      $@

)	       @

,	      "@

-	       @

.	      @

/	       @

{	      @

;	       @

}	      @

>	      @"!
uppercase_percentage	ÎQÚ|±?""
whitespace_percentage	¼?Æ¼?"
list_item_indicator  "

word_count	     @X@"$
average_sentence_length	B>èÙ¬*0@"
vocabulary_density	².n£¼Ù?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      @"
relative_position		ŠcîZÊ?2õ

?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_8Î
ó) {// Fire creation event configChangeEvent. fire (ConfigChangeEvent. pipelineCreated (clusterName, pipelineId, config, initiatedBy )); LOG. info (" Successfully created pipeline ' {} ' in cluster ' {} ' ", pipelineId, clusterName); return ValidationResult. success ();} else {return ValidationResult. failure (" Failed to store pipeline in Consul ");}});});} / ** * Updates an existing pipeline. * / public CompletionStage < ValidationResult > updatePipeline (String clusterName, String pipelineId,?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_8 Œ (ù&:standard_500_50" 
average_word_length	Ð³Yõ¹Ú@"$
potential_heading_score	        "
sentence_count	      @"$
alphanumeric_percentage	B`åÐ"Ûç?"ê
punctuation_countsÓ*Ð

"	      @

'	      @

(	      @

)	       @

*	      @

,	      @

.	      @

/	      @

{	      @

;	      @

<	      ð?

}	      @

>	      ð?"!
uppercase_percentage	q¬‹Ûh°?""
whitespace_percentage	=›UŸ«­À?"
list_item_indicator  "

word_count	     ÀY@"$
average_sentence_length	ËÇº¸m-@"
vocabulary_density	rùé·¯ß?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     0@"
relative_position	®Ø_vOÎ?2ä

?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_9	Í
ò(String clusterName, String pipelineId, PipelineConfig newConfig, String initiatedBy) {LOG. info (" Updating pipeline ' {} ' in cluster ' {} ' ", pipelineId, clusterName); return getPipeline (clusterName, pipelineId). thenCompose (oldConfig - > {if (oldConfig. isEmpty ()) {return CompletableFuture. completedFuture (ValidationResult. failure (" Pipeline ' " + pipelineId + " ' not found " ));} return validatePipelineForUpdate (clusterName, pipelineId, newConfig, oldConfig. get ()). thenCompose (?95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_9 Ó&(¸,:standard_500_50" 
average_word_length	Ñ‘\þC:@"$
potential_heading_score	        "
sentence_count	       @"$
alphanumeric_percentage	+‡ÙÎ÷ç?"Ú
punctuation_countsÃ*À

"	      @

'	      @

(	      &@

)	      "@

{	      @

;	       @

+	       @

,	      "@

}	      @

-	      ð?

.	      @

>	      ð?"!
uppercase_percentage	¾Á&S³?""
whitespace_percentage	þÔxé&1À?"
list_item_indicator  "

word_count	     @Y@"$
average_sentence_length	     @)@"
vocabulary_density	òÒMbXÙ?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      @"
relative_position	©ÐDØðÐ?2ö

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_10
Î
ò. get ()). thenCompose (validationResult - > {if (! validationResult. valid ()) {return CompletableFuture. completedFuture (validationResult);} return storePipelineInConsul (clusterName, pipelineId, newConfig). thenApply (success - > {if (success) {// Fire update event configChangeEvent. fire (ConfigChangeEvent. pipelineUpdated (clusterName, pipelineId, newConfig, oldConfig. get (), initiatedBy )); LOG. info (" Successfully updated pipeline ' {} ' in cluster ' {} ' ", pipelineId, clusterName);@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_10 ˆ,(ò3:standard_500_50" 
average_word_length	Å17@"$
potential_heading_score	        "
sentence_count	      $@"$
alphanumeric_percentage	Õxé&1è?"ê
punctuation_countsÓ*Ð

!	      ð?

"	       @

'	      @

(	      (@

)	      &@

,	       @

-	       @

.	      "@

/	       @

{	      @

;	      @

}	      @

>	       @"!
uppercase_percentage	.ÿ!ýöu°?""
whitespace_percentage	¼t“V¾?"
list_item_indicator  "

word_count	     €Y@"$
average_sentence_length	ffffff$@"
vocabulary_density	@¤ß¾œÛ?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      @"
relative_position	û:pÎˆÒÒ?2‡
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_11Ï
ó' {} ' in cluster ' {} ' ", pipelineId, clusterName); return ValidationResult. success ();} else {return ValidationResult. failure (" Failed to update pipeline in Consul ");}});});});} / ** * Deletes a pipeline. * / public CompletionStage < ValidationResult > deletePipeline (String clusterName, String pipelineId, String initiatedBy) {LOG. info (" Deleting pipeline ' {} ' from cluster ' {} ' ", pipelineId, clusterName); return getPipeline (clusterName, pipelineId). thenCompose (oldConfig - > {if@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_11 Ã3(†::standard_500_50" 
average_word_length	ûËîÉC@"$
potential_heading_score	š™™™™™É?"
sentence_count	      @"$
alphanumeric_percentage	l	ù g³æ?"ú
punctuation_countsã*à

"	      @

'	       @

(	      @

)	      "@

*	      @

,	      @

-	      ð?

.	      @

/	       @

{	      @

;	      @

<	      ð?

}	      $@

>	       @"!
uppercase_percentage	zÇ):’Ë¯?""
whitespace_percentage	-Cëâ6Â?"
list_item_indicator  "

word_count	     @]@"$
average_sentence_length	     €3@"
vocabulary_density	“©‚QIØ?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     0@"
relative_position	NbX9´Ô?2ð

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_12È
ì. thenCompose (oldConfig - > {if (oldConfig. isEmpty ()) {return CompletableFuture. completedFuture (ValidationResult. failure (" Pipeline ' " + pipelineId + " ' not found " ));} return deletePipelineFromConsul (clusterName, pipelineId). thenApply (success - > {if (success) {// Fire deletion event configChangeEvent. fire (ConfigChangeEvent. pipelineDeleted (clusterName, pipelineId, oldConfig. get (), initiatedBy )); LOG. info (" Successfully deleted pipeline ' {} ' from cluster ' {} ' ",@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_12 Õ9(©@:standard_500_50" 
average_word_length		ž^)‹@"$
potential_heading_score	        "
sentence_count	      $@"$
alphanumeric_percentage	`vOjç?"ê
punctuation_countsÓ*Ð

"	      @

'	      @

(	      (@

)	      "@

+	       @

,	      @

-	       @

.	      "@

/	       @

{	      @

;	       @

}	      @

>	       @"!
uppercase_percentage	¤p=
×£°?""
whitespace_percentage	|a2U0*Á?"
list_item_indicator  "

word_count	     ÀY@"$
average_sentence_length	š™™™™™$@"
vocabulary_density	ŒJê4Ý?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     À~@"
relative_position	 ‰°áé•Ö?2õ

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_13Í
ñdeleted pipeline ' {} ' from cluster ' {} ' ", pipelineId, clusterName); return ValidationResult. success ();} else {return ValidationResult. failure (" Failed to delete pipeline from Consul ");}});});} / ** * Gets a pipeline configuration. * / public CompletionStage < Optional < PipelineConfig >> getPipeline (String clusterName, String pipelineId) {return retrievePipelineFromConsul (clusterName, pipelineId);} / ** * Lists all pipelines in a cluster. * / public CompletionStage < Map < String,@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_13 @(ÑE:standard_500_50" 
average_word_length	£’:MD@"$
potential_heading_score	        "
sentence_count	      @"$
alphanumeric_percentage	äòÒoç?"ê
punctuation_countsÓ*Ð

"	      @

'	      @

(	      @

)	      @

*	       @

,	      @

.	      @

/	      @

{	      @

;	      @

<	      @

}	       @

>	       @"!
uppercase_percentage	Ÿ<,Ôšæ­?""
whitespace_percentage	/n£¼Â?"
list_item_indicator  "

word_count	     @Z@"$
average_sentence_length	      5@"
vocabulary_density	Ê2Ä±.nÛ?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     @"
relative_position	·bÙ=yØ?2ô

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_14Ì
ð. * / public CompletionStage < Map < String, PipelineConfig >> listPipelines (String clusterName) {return listPipelinesFromConsul (clusterName);} / ** * Analyzes the impact of deleting a pipeline or module. * / public CompletionStage < DependencyImpactAnalysis > analyzeDeletionImpact (String clusterName, String targetId, DependencyType targetType) {LOG. info (" Analyzing deletion impact for {} ' {} ' in cluster ' {} ' ", targetType, targetId, clusterName); return listPipelines (clusterName).@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_14 ¢E(ŸJ:standard_500_50" 
average_word_length	aTR' ‰@"$
potential_heading_score	        "
sentence_count	      @"$
alphanumeric_percentage	2æ®%äƒè?"ê
punctuation_countsÓ*Ð

"	       @

'	      @

(	      @

)	      @

*	      @

,	      @

.	      @

/	      @

{	      @

;	       @

<	      @

}	      @

>	      @"!
uppercase_percentage	ðHPü³?""
whitespace_percentage	øSã¥›ÄÀ?"
list_item_indicator  "

word_count	     @W@"$
average_sentence_length	     @7@"
vocabulary_density	œ3¢´7øÞ?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      @"
relative_position		ŠcîZÚ?2ó

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_15Ë
ïlistPipelines (clusterName). thenApply (pipelines - > {List < String > affectedPipelines = new ArrayList < > (); List < String > orphanedTopics = new ArrayList < > (); List < String > orphanedServices = new ArrayList < > (); for (var entry: pipelines. entrySet ()) {String pipelineId = entry. getKey (); PipelineConfig pipeline = entry. getValue (); if (targetType == DependencyType. PIPELINE && targetId. equals (pipelineId )) {continue; // Skip the target pipeline itself} boolean isAffected =@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_15 ôI(ƒP:standard_500_50" 
average_word_length	È=›UŸ@"$
potential_heading_score	        "
sentence_count	      @"$
alphanumeric_percentage	OjMóæ?"ê
punctuation_countsÓ*Ð

&	       @

(	      &@

)	      $@

-	      ð?

.	      @

/	       @

:	      ð?

{	      @

;	      @

<	      @

=	       @

}	      ð?

>	      @"!
uppercase_percentage	M„O¯´?""
whitespace_percentage	ÙÎ÷Sã¥Ã?"
list_item_indicator  "

word_count	     €Z@"$
average_sentence_length	a2U0*I.@"
vocabulary_density	B>èÙ¬úÜ?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     ð~@"
relative_position	[±¿ìž<Ü?2¸

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_16À
äboolean isAffected = checkPipelineAffectedByDeletion (pipeline, targetId, targetType); if (isAffected) {affectedPipelines. add (pipelineId);}} return new DependencyImpactAnalysis (targetId, targetType, affectedPipelines, orphanedTopics, orphanedServices, affectedPipelines. isEmpty ());});} / ** * Canonicalizes JSON for consistent ordering and hashing. * Based on the pattern from the old ConsulModuleRegistrationService. * / public String canonicalizeJson (String jsonString) throws@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_16 ðO(ÆV:standard_500_50" 
average_word_length	     À@"$
potential_heading_score	š™™™™™É?"
sentence_count	      @"$
alphanumeric_percentage	?5^ºIê?"º
punctuation_counts£* 

(	      @

)	      @

*	      @

;	      @

{	      ð?

,	      @

=	      ð?

}	      @

.	      @

/	       @"!
uppercase_percentage	à- ø±?""
whitespace_percentage	cîZB>è¹?"
list_item_indicator  "

word_count	      T@"$
average_sentence_length	      0@"
vocabulary_density	333333ã?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     @~@"
relative_position	®Ø_vOÞ?2Å

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_17Í
ñString canonicalizeJson (String jsonString) throws JsonProcessingException {JsonNode node = objectMapper. readTree (jsonString); return canonicalizeJsonNode (node);} private String canonicalizeJsonNode (JsonNode node) throws JsonProcessingException {if (node. isObject ()) {ObjectNode sortedNode = objectMapper. createObjectNode (); List < String > fieldNames = new ArrayList < > (); node. fieldNames (). forEachRemaining (fieldNames :: add); Collections. sort (fieldNames); for (String fieldName:@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_17 –V(âZ:standard_500_50" 
average_word_length	=›UŸ«m@"$
potential_heading_score	        "
sentence_count	      @"$
alphanumeric_percentage	vOjMé?"º
punctuation_counts£* 

(	      (@

)	      &@

:	      @

{	      @

;	      @

<	       @

=	      @

}	      ð?

.	      @

>	       @"!
uppercase_percentage	oƒÀÊ¡µ?""
whitespace_percentage	ŸÍªÏÕV¼?"
list_item_indicator  "

word_count	     ÀV@"$
average_sentence_length	      *@"
vocabulary_density	Ê2Ä±.nÛ?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     @"
relative_position	      à?2æ

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_18Î
ò; for (String fieldName: fieldNames) {JsonNode childNode = node. get (fieldName); if (childNode. isObject () || childNode. isArray ()) {sortedNode. set (fieldName, objectMapper. readTree (canonicalizeJsonNode (childNode )));} else {sortedNode. set (fieldName, childNode);}} return objectMapper. writeValueAsString (sortedNode);} return objectMapper. writeValueAsString (node);} / ** * Generates an MD 5 digest for configuration versioning. * / public String generateConfigDigest (String configJson)@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_18 ±Z(â_:standard_500_50" 
average_word_length	¤p=
×£@"$
potential_heading_score	        "
sentence_count	      $@"$
alphanumeric_percentage	_˜LŒè?"Ú
punctuation_countsÃ*À

(	      (@

)	      (@

:	      ð?

*	      @

;	      @

{	      @

|	       @

,	       @

=	      ð?

}	      @

.	      "@

/	       @"!
uppercase_percentage	O¯”eˆ³?""
whitespace_percentage	Zd;ßO½?"
list_item_indicator  "

word_count	      Y@"$
average_sentence_length	      $@"
vocabulary_density	ÍÌÌÌÌÌÜ?"
digit_percentage	ü©ñÒMb`?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      @"
relative_position	©ÐDØðà?2‘
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_19É
íString generateConfigDigest (String configJson) throws NoSuchAlgorithmException {MessageDigest md = MessageDigest. getInstance (" MD 5 "); byte [] digest = md. digest (configJson. getBytes (StandardCharsets. UTF _ 8 )); return Base 64. getEncoder (). encodeToString (digest);} // Private helper methods private CompletionStage < ValidationResult > validatePipelineForCreation (String clusterName, String pipelineId, PipelineConfig config) {return validationService. validatePipelineStructure (@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_19 µ_(Šd:standard_500_50" 
average_word_length	|a2U0j@"$
potential_heading_score	        "
sentence_count	       @"$
alphanumeric_percentage	òAÏfÕé?"Š
punctuation_countsó*ð

"	       @

(	       @

)	      @

,	       @

.	      @

/	       @

{	       @

;	      @

[	      ð?

<	      ð?

=	       @

]	      ð?

}	      ð?

>	      ð?

_	      ð?"!
uppercase_percentage	„žÍªÏÕ¶?""
whitespace_percentage	Õxé&1¼?"
list_item_indicator  "

word_count	     €T@"$
average_sentence_length	     €$@"
vocabulary_density	Á9#J{ƒã?"
digit_percentage	‚âÇ˜»–€?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     Ð~@"
relative_position	R' ‰°áá?2ç

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_20Ï
óvalidationService. validatePipelineStructure (pipelineId, config). thenCompose (structuralResult - > {if (! structuralResult. valid ()) {return CompletableFuture. completedFuture (structuralResult);} // JSON Schema validation try {String configJson = objectMapper. writeValueAsString (config); return schemaValidationService. validatePipelineStepConfig (configJson). thenApply (schemaResult - > structuralResult. combine (schemaResult ));} catch (JsonProcessingException e) {return CompletableFuture@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_20 ßc(Îi:standard_500_50" 
average_word_length	÷_˜LU@"$
potential_heading_score	š™™™™™É?"
sentence_count	      "@"$
alphanumeric_percentage	_˜LŒJê?"Ú
punctuation_countsÃ*À

!	      ð?

(	      $@

)	      "@

{	      @

;	      @

,	      ð?

-	       @

}	       @

=	      ð?

.	       @

>	       @

/	       @"!
uppercase_percentage	œ3¢´7ø²?""
whitespace_percentage	Ü×sF”¶?"
list_item_indicator  "

word_count	     €S@"$
average_sentence_length	…|Ð³YU!@"
vocabulary_density	q¬‹Ûhà?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     0@"
relative_position	û:pÎˆÒâ?2ÿ

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_21Ç
ë{return CompletableFuture. completedFuture (ValidationResult. failure (" Failed to serialize pipeline config: " + e. getMessage ()));}});} private CompletionStage < ValidationResult > validatePipelineForUpdate (String clusterName, String pipelineId, PipelineConfig newConfig, PipelineConfig oldConfig) {// Same validation as creation for now, but could add update - specific checks return validatePipelineForCreation (clusterName, pipelineId, newConfig);} private CompletionStage < Boolean >@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_21 i(Ên:standard_500_50" 
average_word_length	fffffæ@"$
potential_heading_score	        "
sentence_count	      @"$
alphanumeric_percentage	8gDioðé?"ú
punctuation_countsã*à

"	       @

(	      @

)	      @

+	      ð?

,	      @

-	      ð?

.	      @

/	       @

:	      ð?

{	       @

;	      @

<	       @

}	      @

>	       @"!
uppercase_percentage	eâX·±?""
whitespace_percentage	È=›UŸ»?"
list_item_indicator  "

word_count	      T@"$
average_sentence_length	      4@"
vocabulary_density	ffffffä?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     °~@"
relative_position	¥N@aÃã?2‡
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_22Ï
ó);} private CompletionStage < Boolean > storePipelineInConsul (String clusterName, String pipelineId, PipelineConfig config) {return CompletableFuture. supplyAsync (() - > {try {String configJson = canonicalizeJson (objectMapper. writeValueAsString (config )); String consulKey = buildPipelineKey (clusterName, pipelineId); HttpRequest request = HttpRequest. newBuilder (). uri (URI. create (consulBaseUrl + " / v 1 / kv / " + consulKey )). PUT (HttpRequest. BodyPublishers. ofString (configJson )).@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_22 ™n(œs:standard_500_50" 
average_word_length	‚âÇ˜»Ö@"$
potential_heading_score	        "
sentence_count	      "@"$
alphanumeric_percentage	Âõ(\è?"ú
punctuation_countsã*à

"	       @

(	      &@

)	      &@

+	       @

,	      @

-	      ð?

.	      "@

/	      @

;	      @

{	      @

<	      ð?

}	      ð?

=	      @

>	       @"!
uppercase_percentage	à- ¸?""
whitespace_percentage	*:’ËH¿?"
list_item_indicator  "

word_count	     @W@"$
average_sentence_length	{ƒ/L¦ª$@"
vocabulary_density	2æ®%äƒà?"
digit_percentage	ü©ñÒMb`?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     0@"
relative_position	0»'µä?2ô

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_23Ì
ð. ofString (configJson )). build (); HttpResponse < String > response = httpClient. send (request, HttpResponse. BodyHandlers. ofString ()); boolean success = response. statusCode () == 200; if (success) {LOG. debug (" Stored pipeline ' {} ' in Consul at key ' {} ' ", pipelineId, consulKey);} else {LOG. error (" Failed to store pipeline ' {} ' in Consul. Status: {}, Body: {} ", pipelineId, response. statusCode (), response. body ());} return success;} catch (Exception e) {LOG. error (" Error@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_23 ír(Ëx:standard_500_50" 
average_word_length	/n£¼	@"$
potential_heading_score	š™™™™™É?"
sentence_count	      *@"$
alphanumeric_percentage	$(~Œ¹kå?"ê
punctuation_countsÓ*Ð

"	      @

'	      @

(	      (@

)	      (@

,	      @

.	      (@

:	       @

;	      @

{	       @

<	      ð?

=	      @

}	       @

>	      ð?"!
uppercase_percentage	 /Ý$±?""
whitespace_percentage	h"lxz¥Ä?"
list_item_indicator  "

word_count	      `@"$
average_sentence_length	gÕçj+v$@"
vocabulary_density	/Ý$Ù?"
digit_percentage	ú~j¼t“x?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      @"
relative_position	ÙÎ÷Sã¥å?2¸
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_24Ð
ô(Exception e) {LOG. error (" Error storing pipeline ' {} ' in Consul: {} ", pipelineId, e. getMessage (), e); return false;}});} private CompletionStage < Optional < PipelineConfig >> retrievePipelineFromConsul (String clusterName, String pipelineId) {return CompletableFuture. supplyAsync (() - > {try {String consulKey = buildPipelineKey (clusterName, pipelineId); HttpRequest request = HttpRequest. newBuilder (). uri (URI. create (consulBaseUrl + " / v 1 / kv / " + consulKey + "? raw " )). GET (@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_24 œx(ª}:standard_500_50" 
average_word_length	•Ô	h¢@"$
potential_heading_score	        "
sentence_count	       @"$
alphanumeric_percentage	-²ï§æ?"ª
punctuation_counts“*

"	      @

'	       @

(	      &@

)	      $@

+	      @

,	      @

-	      ð?

.	      @

/	      @

:	      ð?

{	      @

;	      @

<	       @

}	      @

=	       @

>	      @

?	      ð?"!
uppercase_percentage	j¼t“¶?""
whitespace_percentage	‹lçû©ñÂ?"
list_item_indicator  "

word_count	     À\@"$
average_sentence_length	     À,@"
vocabulary_density	úíëÀ9#à?"
digit_percentage	ü©ñÒMb`?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     @@"
relative_position	‚âÇ˜»–æ?2˜
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_25Ð
óconsulKey + "? raw " )). GET (). build (); HttpResponse < String > response = httpClient. send (request, HttpResponse. BodyHandlers. ofString ()); if (response. statusCode () == 200) {PipelineConfig config = objectMapper. readValue (response. body (), PipelineConfig. class); return Optional. of (config);} else if (response. statusCode () == 404) {return Optional. < PipelineConfig > empty ();} else {LOG. error (" Failed to retrieve pipeline ' {} ' from Consul. Status: {} ", pipelineId, response.@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_25 ù|(¯‚:standard_500_50" 
average_word_length	333333@"$
potential_heading_score	        "
sentence_count	      .@"$
alphanumeric_percentage	|a2U0æ?"Š
punctuation_countsó*ð

"	      @

'	       @

(	      *@

)	      ,@

+	      ð?

,	      @

.	      .@

:	      ð?

;	      @

{	      @

<	       @

=	      @

}	      @

>	       @

?	      ð?"!
uppercase_percentage	q¬‹Ûh°?""
whitespace_percentage	$—ÿ~ûÂ?"
list_item_indicator  "

word_count	     @_@"$
average_sentence_length	{ƒ/L¦ª @"
vocabulary_density	ÙÎ÷Sã¥Û?"
digit_percentage	ú~j¼t“ˆ?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     0@"
relative_position	+ö—Ý“‡ç?2‚
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_26Ê
ì} ' from Consul. Status: {} ", pipelineId, response. statusCode ()); return Optional. < PipelineConfig > empty ();}} catch (Exception e) {LOG. error (" Error retrieving pipeline ' {} ' from Consul: {} ", pipelineId, e. getMessage (), e); return Optional. < PipelineConfig > empty ();}});} private CompletionStage < Boolean > deletePipelineFromConsul (String clusterName, String pipelineId) {return CompletableFuture. supplyAsync (() - > {try {String consulKey = buildPipelineKey (clusterName,@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_26 þ(é†:standard_500_50" 
average_word_length	z6«>W[@"$
potential_heading_score	        "
sentence_count	       @"$
alphanumeric_percentage	ö(\Âõæ?"ú
punctuation_countsã*à

"	      @

'	      @

(	      $@

)	      $@

,	      @

-	      ð?

.	      @

:	       @

{	      @

;	      @

<	      @

}	      "@

=	      ð?

>	      @"!
uppercase_percentage	46<½²?""
whitespace_percentage	¬‹Ûh oÁ?"
list_item_indicator  "

word_count	      \@"$
average_sentence_length	      ,@"
vocabulary_density	Ð³Yõ¹ÚÚ?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     À~@"
relative_position	Õ	h"lxè?2‡
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_27Ï
ñString consulKey = buildPipelineKey (clusterName, pipelineId); HttpRequest request = HttpRequest. newBuilder (). uri (URI. create (consulBaseUrl + " / v 1 / kv / " + consulKey )). DELETE (). build (); HttpResponse < String > response = httpClient. send (request, HttpResponse. BodyHandlers. ofString ()); boolean success = response. statusCode () == 200; if (success) {LOG. debug (" Deleted pipeline ' {} ' from Consul at key ' {} ' ", pipelineId, consulKey);} else {LOG. error (" Failed to delete@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_27 º†(û‹:standard_500_50" 
average_word_length	 AñcÌÝ@"$
potential_heading_score	š™™™™™É?"
sentence_count	      (@"$
alphanumeric_percentage	×4ï8EGæ?"ú
punctuation_countsã*à

"	      @

'	      @

(	      (@

)	      &@

+	       @

,	      @

.	      &@

/	      @

;	      @

{	      @

<	      ð?

=	      @

}	      @

>	      ð?"!
uppercase_percentage	-²ï§¶?""
whitespace_percentage	'1¬ZÄ?"
list_item_indicator  "

word_count	      ^@"$
average_sentence_length	      $@"
vocabulary_density	ffffffÞ?"
digit_percentage	ü©ñÒMb€?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     @"
relative_position	~8gDié?2¨
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_28Ð
ò{LOG. error (" Failed to delete pipeline ' {} ' from Consul. Status: {} ", pipelineId, response. statusCode ());} return success;} catch (Exception e) {LOG. error (" Error deleting pipeline ' {} ' from Consul: {} ", pipelineId, e. getMessage (), e); return false;}});} private CompletionStage < Map < String, PipelineConfig >> listPipelinesFromConsul (String clusterName) {return CompletableFuture. supplyAsync (() - > {try {String consulPrefix = buildClusterPrefix (clusterName) + " pipelines / ";@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_28 Ë‹(ß:standard_500_50" 
average_word_length	ÞqŠŽäò@"$
potential_heading_score	        "
sentence_count	      @"$
alphanumeric_percentage	ušžæ?"š
punctuation_countsƒ*€

"	      @

'	      @

(	      "@

)	      "@

+	      ð?

,	      @

-	      ð?

.	      @

/	      ð?

:	       @

{	      "@

;	      @

<	       @

}	      "@

=	      ð?

>	      @"!
uppercase_percentage	§èH.ÿ±?""
whitespace_percentage	Æm4€·@Â?"
list_item_indicator  "

word_count	     €]@"$
average_sentence_length	ÏfÕçjÛ0@"
vocabulary_density	“©‚QIÝ?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      @"
relative_position	'1¬Zê?2™
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_29Ñ
ó= buildClusterPrefix (clusterName) + " pipelines / "; HttpRequest request = HttpRequest. newBuilder (). uri (URI. create (consulBaseUrl + " / v 1 / kv / " + consulPrefix + "? keys " )). GET (). build (); HttpResponse < String > response = httpClient. send (request, HttpResponse. BodyHandlers. ofString ()); if (response. statusCode () == 200) {String [] keys = objectMapper. readValue (response. body (), String []. class); Map < String, PipelineConfig > pipelines = new HashMap < > (); for (String@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_29 ¯(ò•:standard_500_50" 
average_word_length	H¿}8ç
@"$
potential_heading_score	š™™™™™É?"
sentence_count	      *@"$
alphanumeric_percentage	"ýöuàœå?"Š
punctuation_countsó*ð

"	      @

(	      ,@

)	      *@

+	      @

,	      @

.	      (@

/	      @

;	      @

{	      ð?

[	       @

<	      @

=	      @

]	       @

>	      @

?	      ð?"!
uppercase_percentage	ý‡ôÛ×³?""
whitespace_percentage	dÌ]KÈÅ?"
list_item_indicator  "

word_count	      _@"$
average_sentence_length	ÁÊ¡E¶#@"
vocabulary_density	˜Ý“‡…ZÛ?"
digit_percentage	ü©ñÒMb€?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     0@"
relative_position	ÐDØðôJë?2…
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_30Í
ïfor (String key: keys) {String pipelineId = extractPipelineIdFromKey (key); if (pipelineId! = null) {Optional < PipelineConfig > config = retrievePipelineFromConsul (clusterName, pipelineId). toCompletableFuture (). join (); config. ifPresent (c - > pipelines. put (pipelineId, c ));}} return pipelines;} else if (response. statusCode () == 404) {return new HashMap < String, PipelineConfig > ();} else {LOG. error (" Failed to list pipelines from Consul. Status: {} ", response. statusCode ());@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_30 è•(É›:standard_500_50" 
average_word_length	¦›Ä °r@"$
potential_heading_score	        "
sentence_count	      "@"$
alphanumeric_percentage	£¼ç?"ú
punctuation_countsã*à

!	      ð?

"	       @

(	      *@

)	      *@

,	      @

-	      ð?

.	       @

:	       @

{	      @

;	      @

<	       @

=	      @

}	      @

>	      @"!
uppercase_percentage	Á¨¤N@±?""
whitespace_percentage	6<½R–Á?"
list_item_indicator  "

word_count	      ]@"$
average_sentence_length	,ÔšæÇ)@"
vocabulary_density	ÜFx$Ü?"
digit_percentage	ðHPüx?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     ð~@"
relative_position	[±¿ìž<ì?2é

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_31Ñ
ófrom Consul. Status: {} ", response. statusCode ()); return new HashMap < String, PipelineConfig > ();}} catch (Exception e) {LOG. error (" Error listing pipelines from Consul: {} ", e. getMessage (), e); return new HashMap < String, PipelineConfig > ();}});} private boolean checkPipelineAffectedByDeletion (PipelineConfig pipeline, String targetId, DependencyType targetType) {if (pipeline. pipelineSteps () == null) {return false;} for (PipelineStepConfig step: pipeline. pipelineSteps (). values@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_31 ™›(œ :standard_500_50" 
average_word_length	ësµûË@"$
potential_heading_score	š™™™™™É?"
sentence_count	       @"$
alphanumeric_percentage	ð§ÆK7‰ç?"Ú
punctuation_countsÃ*À

"	      @

(	      &@

)	      (@

:	      @

{	      @

;	      @

,	      @

<	       @

}	       @

=	       @

.	      @

>	       @"!
uppercase_percentage	L¦
F%u²?""
whitespace_percentage	•Ô	h"lÀ?"
list_item_indicator  "

word_count	     @\@"$
average_sentence_length	     @,@"
vocabulary_density	«ÏÕVì/Û?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     0@"
relative_position	Å1w-í?2Ó

@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_32 Ë
ístep: pipeline. pipelineSteps (). values ()) {if (targetType == DependencyType. MODULE && step. processorInfo ()! = null && targetId. equals (step. processorInfo (). grpcServiceName ())) {return true;} if (step. outputs ()! = null) {for (var output: step. outputs (). values ()) {if (output. grpcTransport ()! = null && targetId. equals (output. grpcTransport (). serviceName ())) {return true;}}}} return false;} private String buildPipelineKey (String clusterName, String pipelineId) {return@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_32 ÷Ÿ(Ú¥:standard_500_50" 
average_word_length	¿œ3¢´@"$
potential_heading_score	š™™™™™É?"
sentence_count	      .@"$
alphanumeric_percentage	øÂdª`Tæ?"Ê
punctuation_counts³*°

!	      @

&	      @

(	      2@

)	      3@

:	       @

{	      @

;	      @

,	      ð?

=	      @

}	      @

.	      ,@"!
uppercase_percentage	$—ÿ~ûª?""
whitespace_percentage	kšwœ¢#Á?"
list_item_indicator  "

word_count	     À]@"$
average_sentence_length	]mÅþ²»@"
vocabulary_density	 ‰°áé•Ö?"
digit_percentage	        "
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	     Ð~@"
relative_position	®Ø_vOî?2¶
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_33!Î
ðclusterName, String pipelineId) {return buildClusterPrefix (clusterName) + " pipelines / " + pipelineId + " / config ";} private String buildClusterPrefix (String clusterName) {return " rokkon - clusters / " + clusterName + " / ";} private String extractPipelineIdFromKey (String key) {// Extract from: rokkon - clusters / {cluster} / pipelines / {pipelineId} / config String [] parts = key. split (" / "); if (parts. length > = 4 && " pipelines ". equals (parts [2] )) {return parts [3];} return@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_33 «¥(×©:standard_500_50" 
average_word_length	Qkšwœ"@"$
potential_heading_score	š™™™™™É?"
sentence_count	      @"$
alphanumeric_percentage	      æ?"ª
punctuation_counts“*

"	      (@

&	       @

(	      @

)	      @

+	      @

,	      ð?

-	       @

.	      @

/	      &@

:	      ð?

{	      @

;	      @

[	      @

}	      @

]	      @

=	       @

>	      ð?"!
uppercase_percentage	A‚âÇ˜»¦?""
whitespace_percentage	é·¯çÄ?"
list_item_indicator  "

word_count	     €]@"$
average_sentence_length	     €=@"
vocabulary_density	ž^)ËÇÖ?"
digit_percentage	ú~j¼t“x?"
is_last_chunk  "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      @"
relative_position	Wì/»'ï?2¨	
@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_34" 
Âreturn parts [3];} return null;} // Supporting classes public record DependencyImpactAnalysis (String targetId, DependencyType targetType, List < String > affectedPipelines, List < String > orphanedTopics, List < String > orphanedServices, boolean canSafelyDelete) {} public enum DependencyType {PIPELINE, MODULE, SCHEMA}}@95b47a92-b543-40fd-b811-127ac306e817_tika-input-doc-018_chunk_34 ¯©(ó¬:standard_500_50" 
average_word_length	®Gázî@"$
potential_heading_score	333333Ó?"
sentence_count	      ð?"$
alphanumeric_percentage	q=
×£pé?"Ê
punctuation_counts³*°

(	      ð?

)	      ð?

[	      ð?

;	       @

{	       @

,	      @

<	      @

]	      ð?

}	      @

>	      @

/	       @"!
uppercase_percentage	Åþ²{ò°À?""
whitespace_percentage	h‘í|?5¾?"
list_item_indicator  "

word_count	     €L@"$
average_sentence_length	     €L@"
vocabulary_density	ÙÎ÷Sã¥ã?"
digit_percentage	aÃÓ+ei?"
is_last_chunk "
contains_urlplaceholder  "
is_first_chunk  "
character_count	      t@"
relative_position	      ð?