
tika-input-doc-122*‚Ñsource-code/SecurityIntegrationTests_v5.java source-code/SecurityIntegrationTests_v5.java//Â VARIATIONÂ 122Â ofÂ SecurityÂ TestÂ SourceÂ (VariantÂ 5) //Â GeneratedÂ on:Â 2025-06-18T14:38:08.506001789Z //Â BaseÂ file:Â source-code/SecurityIntegrationTests.java packageÂ com.rokkon.integration.security; importÂ com.google.protobuf.ByteString; importÂ com.google.protobuf.Empty; importÂ com.google.protobuf.Struct; importÂ com.google.protobuf.Value; importÂ com.rokkon.search.model.*; importÂ com.rokkon.search.sdk.*; importÂ io.grpc.ManagedChannel; importÂ io.grpc.ManagedChannelBuilder; importÂ io.grpc.Status; importÂ io.grpc.StatusRuntimeException; importÂ io.quarkus.test.junit.QuarkusIntegrationTest; importÂ org.junit.jupiter.api.*; importÂ org.slf4j.Logger; importÂ org.slf4j.LoggerFactory; importÂ java.nio.charset.StandardCharsets; importÂ java.security.MessageDigest; importÂ java.util.*; importÂ java.util.concurrent.TimeUnit; importÂ java.util.regex.Pattern; importÂ staticÂ org.junit.jupiter.api.Assertions.*; /** Â *Â ComprehensiveÂ securityÂ integrationÂ testsÂ toÂ validateÂ inputÂ validation,Â maliciousÂ contentÂ handling, Â *Â dataÂ integrityÂ verification,Â andÂ securityÂ boundariesÂ acrossÂ allÂ services. Â *Â  Â *Â TheseÂ testsÂ verify: Â *Â -Â InputÂ validationÂ andÂ sanitization Â *Â -Â MaliciousÂ contentÂ detectionÂ andÂ handling Â *Â -Â DataÂ integrityÂ verificationÂ andÂ checksums Â *Â -Â SecurityÂ boundaryÂ enforcement Â *Â -Â BufferÂ overflowÂ andÂ injectionÂ attackÂ prevention Â *Â -Â ContentÂ filteringÂ andÂ blacklistÂ enforcement Â *Â -Â SecureÂ errorÂ handlingÂ withoutÂ informationÂ leakage Â *Â -Â AuthenticationÂ andÂ authorizationÂ patterns Â *Â -Â SecureÂ dataÂ transmissionÂ andÂ storage Â *Â -Â PrivacyÂ andÂ dataÂ protectionÂ compliance Â */ @QuarkusIntegrationTest @TestMethodOrder(MethodOrderer.OrderAnnotation.class) @Disabled("RequiresÂ fullÂ gRPCÂ serviceÂ infrastructureÂ forÂ comprehensiveÂ securityÂ testingÂ againstÂ maliciousÂ inputsÂ andÂ attacks") classÂ SecurityIntegrationTestsÂ { Â Â Â Â privateÂ staticÂ finalÂ LoggerÂ LOGÂ =Â LoggerFactory.getLogger(SecurityIntegrationTests.class); Â Â Â Â  Â Â Â Â //Â SecurityÂ testÂ patterns Â Â Â Â privateÂ staticÂ finalÂ List<String>Â SQL_INJECTION_PATTERNSÂ =Â Arrays.asList( Â Â Â Â Â Â Â Â "';Â DROPÂ TABLEÂ users;Â --", Â Â Â Â Â Â Â Â "'Â ORÂ '1'='1", Â Â Â Â Â Â Â Â "'Â UNIONÂ SELECTÂ *Â FROMÂ sensitive_dataÂ --", Â Â Â Â Â Â Â Â "admin'--", Â Â Â Â Â Â Â Â "'Â ORÂ 1=1#" Â Â Â Â ); Â Â Â Â  Â Â Â Â privateÂ staticÂ finalÂ List<String>Â XSS_PATTERNSÂ =Â Arrays.asList( Â Â Â Â Â Â Â Â "<script>alert('XSS')</script>", Â Â Â Â Â Â Â Â "javascript:alert('XSS')", Â Â Â Â Â Â Â Â "<imgÂ src=xÂ onerror=alert('XSS')>", Â Â Â Â Â Â Â Â "<svgÂ onload=alert('XSS')>", Â Â Â Â Â Â Â Â "';alert('XSS');//" Â Â Â Â ); Â Â Â Â  Â Â Â Â privateÂ staticÂ finalÂ List<String>Â COMMAND_INJECTION_PATTERNSÂ =Â Arrays.asList( Â Â Â Â Â Â Â Â ";Â rmÂ -rfÂ /", Â Â Â Â Â Â Â Â "|Â catÂ /etc/passwd", Â Â Â Â Â Â Â Â "&&Â whoami", Â Â Â Â Â Â Â Â "`rmÂ -rfÂ /`", Â Â Â Â Â Â Â Â "$(catÂ /etc/passwd)" Â Â Â Â ); Â Â Â Â  Â Â Â Â privateÂ staticÂ finalÂ List<String>Â PATH_TRAVERSAL_PATTERNSÂ =Â Arrays.asList( Â Â Â Â Â Â Â Â "../../../etc/passwd", Â Â Â Â Â Â Â Â "..\\..\\..\\windows\\system32\\config\\sam", Â Â Â Â Â Â Â Â "....//....//....//etc/passwd", Â Â Â Â Â Â Â Â "%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd", Â Â Â Â Â Â Â Â "..%252f..%252f..%252fetc%252fpasswd" Â Â Â Â ); Â Â Â Â  Â Â Â Â //Â ContentÂ securityÂ patterns Â Â Â Â privateÂ staticÂ finalÂ PatternÂ SUSPICIOUS_PATTERNÂ =Â Pattern.compile( Â Â Â Â Â Â Â Â "(?i)(password|secret|key|token|auth|admin|root|exploit|hack|inject|malware|virus)", Â Â Â Â Â Â Â Â Pattern.CASE_INSENSITIVEÂ |Â Pattern.MULTILINE Â Â Â Â ); Â Â Â Â  Â Â Â Â privateÂ staticÂ finalÂ longÂ MAX_CONTENT_SIZEÂ =Â 100Â *Â 1024Â *Â 1024;Â //Â 100MB Â Â Â Â privateÂ staticÂ finalÂ intÂ MAX_FIELD_LENGTHÂ =Â 10000; Â Â Â Â  Â Â Â Â privateÂ ManagedChannelÂ tikaChannel; Â Â Â Â privateÂ ManagedChannelÂ chunkerChannel; Â Â Â Â privateÂ ManagedChannelÂ embedderChannel; Â Â Â Â privateÂ ManagedChannelÂ echoChannel; Â Â Â Â  Â Â Â Â privateÂ PipeStepProcessorGrpc.PipeStepProcessorBlockingStubÂ tikaClient; Â Â Â Â privateÂ PipeStepProcessorGrpc.PipeStepProcessorBlockingStubÂ chunkerClient; Â Â Â Â privateÂ PipeStepProcessorGrpc.PipeStepProcessorBlockingStubÂ embedderClient; Â Â Â Â privateÂ PipeStepProcessorGrpc.PipeStepProcessorBlockingStubÂ echoClient; Â Â Â Â @BeforeEach Â Â Â Â voidÂ setUp()Â { Â Â Â Â Â Â Â Â //Â SetÂ upÂ gRPCÂ channelsÂ forÂ securityÂ testing Â Â Â Â Â Â Â Â tikaChannelÂ =Â ManagedChannelBuilder.forAddress("localhost",Â 9000).usePlaintext().build(); Â Â Â Â Â Â Â Â chunkerChannelÂ =Â ManagedChannelBuilder.forAddress("localhost",Â 9001).usePlaintext().build(); Â Â Â Â Â Â Â Â embedderChannelÂ =Â ManagedChannelBuilder.forAddress("localhost",Â 9002).usePlaintext().build(); Â Â Â Â Â Â Â Â echoChannelÂ =Â ManagedChannelBuilder.forAddress("localhost",Â 9003).usePlaintext().build(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â tikaClientÂ =Â PipeStepProcessorGrpc.newBlockingStub(tikaChannel); Â Â Â Â Â Â Â Â chunkerClientÂ =Â PipeStepProcessorGrpc.newBlockingStub(chunkerChannel); Â Â Â Â Â Â Â Â embedderClientÂ =Â PipeStepProcessorGrpc.newBlockingStub(embedderChannel); Â Â Â Â Â Â Â Â echoClientÂ =Â PipeStepProcessorGrpc.newBlockingStub(echoChannel); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â LOG.info("SecurityÂ integrationÂ testÂ environmentÂ initialized"); Â Â Â Â } Â Â Â Â @AfterEachÂ  Â Â Â Â voidÂ tearDown()Â throwsÂ InterruptedExceptionÂ { Â Â Â Â Â Â Â Â ifÂ (tikaChannelÂ !=Â null)Â { Â Â Â Â Â Â Â Â Â Â Â Â tikaChannel.shutdown(); Â Â Â Â Â Â Â Â Â Â Â Â tikaChannel.awaitTermination(5,Â TimeUnit.SECONDS); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â ifÂ (chunkerChannelÂ !=Â null)Â { Â Â Â Â Â Â Â Â Â Â Â Â chunkerChannel.shutdown(); Â Â Â Â Â Â Â Â Â Â Â Â chunkerChannel.awaitTermination(5,Â TimeUnit.SECONDS); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â ifÂ (embedderChannelÂ !=Â null)Â { Â Â Â Â Â Â Â Â Â Â Â Â embedderChannel.shutdown(); Â Â Â Â Â Â Â Â Â Â Â Â embedderChannel.awaitTermination(5,Â TimeUnit.SECONDS); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â ifÂ (echoChannelÂ !=Â null)Â { Â Â Â Â Â Â Â Â Â Â Â Â echoChannel.shutdown(); Â Â Â Â Â Â Â Â Â Â Â Â echoChannel.awaitTermination(5,Â TimeUnit.SECONDS); Â Â Â Â Â Â Â Â } Â Â Â Â } Â Â Â Â @Test Â Â Â Â @Order(1) Â Â Â Â @DisplayName("SQLÂ InjectionÂ AttackÂ Prevention") Â Â Â Â voidÂ testSqlInjectionPrevention()Â { Â Â Â Â Â Â Â Â LOG.info("TestingÂ SQLÂ injectionÂ attackÂ prevention"); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Map<String,Â Integer>Â serviceVulnerabilitiesÂ =Â newÂ HashMap<>(); Â Â Â Â Â Â Â Â intÂ totalInjectionAttemptsÂ =Â 0; Â Â Â Â Â Â Â Â intÂ blockedAttemptsÂ =Â 0; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â forÂ (StringÂ injectionPatternÂ :Â SQL_INJECTION_PATTERNS)Â { Â Â Â Â Â Â Â Â Â Â Â Â totalInjectionAttempts++; Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â //Â TestÂ eachÂ serviceÂ withÂ SQLÂ injectionÂ patterns Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (testServiceWithMaliciousInput(tikaClient,Â "tika",Â injectionPattern,Â "SQLÂ Injection"))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedAttempts++; Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serviceVulnerabilities.merge("tika",Â 1,Â Integer::sum); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (testServiceWithMaliciousInput(chunkerClient,Â "chunker",Â injectionPattern,Â "SQLÂ Injection"))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedAttempts++; Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serviceVulnerabilities.merge("chunker",Â 1,Â Integer::sum); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (testServiceWithMaliciousInput(embedderClient,Â "embedder",Â injectionPattern,Â "SQLÂ Injection"))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedAttempts++; Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serviceVulnerabilities.merge("embedder",Â 1,Â Integer::sum); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (testServiceWithMaliciousInput(echoClient,Â "echo",Â injectionPattern,Â "SQLÂ Injection"))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedAttempts++; Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serviceVulnerabilities.merge("echo",Â 1,Â Integer::sum); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â totalInjectionAttemptsÂ +=Â 3;Â //Â AddedÂ 3Â moreÂ services Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â doubleÂ blockingRateÂ =Â (double)Â blockedAttemptsÂ /Â totalInjectionAttempts; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â VerifyÂ SQLÂ injectionÂ protection Â Â Â Â Â Â Â Â assertTrue(blockingRateÂ >=Â 0.90,Â  Â Â Â Â Â Â Â Â Â Â Â Â String.format("SQLÂ injectionÂ blockingÂ rateÂ %.2f%%Â belowÂ minimumÂ 90%%",Â blockingRateÂ *Â 100)); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â CheckÂ forÂ service-specificÂ vulnerabilities Â Â Â Â Â Â Â Â forÂ (Map.Entry<String,Â Integer>Â entryÂ :Â serviceVulnerabilities.entrySet())Â { Â Â Â Â Â Â Â Â Â Â Â Â StringÂ serviceNameÂ =Â entry.getKey(); Â Â Â Â Â Â Â Â Â Â Â Â IntegerÂ vulnerabilityCountÂ =Â entry.getValue(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â assertTrue(vulnerabilityCountÂ <=Â 1,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String.format("%sÂ serviceÂ hasÂ %dÂ SQLÂ injectionÂ vulnerabilities",Â serviceName,Â vulnerabilityCount)); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â LOG.info("âœ…Â SQLÂ injectionÂ preventionÂ testÂ completedÂ -Â BlockingÂ rate:Â {:.2f}%,Â Vulnerabilities:Â {}",Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockingRateÂ *Â 100,Â serviceVulnerabilities); Â Â Â Â } Â Â Â Â @Test Â Â Â Â @Order(2) Â Â Â Â @DisplayName("Cross-SiteÂ ScriptingÂ (XSS)Â Prevention") Â Â Â Â voidÂ testXssPreventionAndSanitization()Â { Â Â Â Â Â Â Â Â LOG.info("TestingÂ XSSÂ preventionÂ andÂ contentÂ sanitization"); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â intÂ totalXssAttemptsÂ =Â 0; Â Â Â Â Â Â Â Â intÂ sanitizedResponsesÂ =Â 0; Â Â Â Â Â Â Â Â List<String>Â unsanitizedResponsesÂ =Â newÂ ArrayList<>(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â forÂ (StringÂ xssPatternÂ :Â XSS_PATTERNS)Â { Â Â Â Â Â Â Â Â Â Â Â Â totalXssAttempts++; Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â //Â TestÂ XSSÂ patternÂ handlingÂ inÂ documentÂ content Â Â Â Â Â Â Â Â Â Â Â Â PipeDocÂ maliciousDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("xss-test-"Â +Â System.currentTimeMillis()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle("XSSÂ Test:Â "Â +Â xssPattern) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBody("ContentÂ withÂ XSSÂ attempt:Â "Â +Â xssPattern) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ProcessRequestÂ requestÂ =Â createProcessRequest("xss-security-test",Â "echo-step",Â maliciousDoc); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â echoClient.processData(request); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (response.getSuccess())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ responseTitleÂ =Â response.getOutputDoc().getTitle(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ responseBodyÂ =Â response.getOutputDoc().getBody(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â CheckÂ ifÂ XSSÂ patternsÂ wereÂ sanitizedÂ orÂ escaped Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ titleSanitizedÂ =Â !responseTitle.contains("<script>")Â &&Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â !responseTitle.contains("javascript:")Â && Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â !responseTitle.contains("onerror=")Â && Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â !responseTitle.contains("onload="); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ bodySanitizedÂ =Â !responseBody.contains("<script>")Â &&Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â !responseBody.contains("javascript:")Â && Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â !responseBody.contains("onerror=")Â && Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â !responseBody.contains("onload="); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (titleSanitizedÂ &&Â bodySanitized)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sanitizedResponses++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â unsanitizedResponses.add("Pattern:Â "Â +Â xssPatternÂ +Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "Â -Â Title:Â "Â +Â responseTitleÂ +Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "Â -Â Body:Â "Â +Â responseBody); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â ServiceÂ rejectedÂ maliciousÂ contentÂ -Â alsoÂ countsÂ asÂ protection Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sanitizedResponses++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (StatusRuntimeExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â ServiceÂ blockedÂ theÂ requestÂ -Â thisÂ isÂ good Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sanitizedResponses++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.debug("XSSÂ patternÂ blockedÂ byÂ service:Â {}",Â xssPattern); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â doubleÂ sanitizationRateÂ =Â (double)Â sanitizedResponsesÂ /Â totalXssAttempts; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â assertTrue(sanitizationRateÂ >=Â 0.95,Â  Â Â Â Â Â Â Â Â Â Â Â Â String.format("XSSÂ sanitizationÂ rateÂ %.2f%%Â belowÂ minimumÂ 95%%",Â sanitizationRateÂ *Â 100)); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â assertTrue(unsanitizedResponses.size()Â <=Â 1,Â  Â Â Â Â Â Â Â Â Â Â Â Â String.format("TooÂ manyÂ unsanitizedÂ XSSÂ responses:Â %s",Â unsanitizedResponses)); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â LOG.info("âœ…Â XSSÂ preventionÂ testÂ completedÂ -Â SanitizationÂ rate:Â {:.2f}%,Â Unsanitized:Â {}",Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sanitizationRateÂ *Â 100,Â unsanitizedResponses.size()); Â Â Â Â } Â Â Â Â @Test Â Â Â Â @Order(3) Â Â Â Â @DisplayName("CommandÂ InjectionÂ AttackÂ Prevention") Â Â Â Â voidÂ testCommandInjectionPrevention()Â { Â Â Â Â Â Â Â Â LOG.info("TestingÂ commandÂ injectionÂ attackÂ prevention"); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â intÂ totalCommandAttemptsÂ =Â 0; Â Â Â Â Â Â Â Â intÂ blockedCommandsÂ =Â 0; Â Â Â Â Â Â Â Â Map<String,Â List<String>>Â serviceFailuresÂ =Â newÂ HashMap<>(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â forÂ (StringÂ commandPatternÂ :Â COMMAND_INJECTION_PATTERNS)Â { Â Â Â Â Â Â Â Â Â Â Â Â totalCommandAttempts++; Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â //Â TestÂ commandÂ injectionÂ inÂ documentÂ processing Â Â Â Â Â Â Â Â Â Â Â Â StringÂ maliciousContentÂ =Â "DocumentÂ contentÂ withÂ commandÂ injection:Â "Â +Â commandPattern; Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â //Â TestÂ TikaÂ serviceÂ (mostÂ likelyÂ toÂ executeÂ commandsÂ onÂ files) Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (testTikaServiceWithMaliciousCommand(commandPattern))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedCommands++; Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serviceFailures.computeIfAbsent("tika",Â kÂ ->Â newÂ ArrayList<>()).add(commandPattern); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â //Â TestÂ otherÂ services Â Â Â Â Â Â Â Â Â Â Â Â forÂ (StringÂ serviceNameÂ :Â Arrays.asList("chunker",Â "embedder",Â "echo"))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PipeDocÂ maliciousDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("cmd-injection-"Â +Â System.currentTimeMillis()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle("CommandÂ injectionÂ test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBody(maliciousContent) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ProcessRequestÂ requestÂ =Â createProcessRequest("command-injection-test",Â serviceNameÂ +Â "-step",Â maliciousDoc); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PipeStepProcessorGrpc.PipeStepProcessorBlockingStubÂ clientÂ =Â getClientForService(serviceName); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ ("embedder".equals(serviceName))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â requestÂ =Â createEmbedderProcessRequest("command-injection-test",Â serviceNameÂ +Â "-step",Â maliciousDoc); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â client.processData(request); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â VerifyÂ noÂ commandÂ executionÂ artifactsÂ inÂ response Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (response.getSuccess())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ responseContentÂ =Â response.getOutputDoc().getBody(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â CheckÂ forÂ signsÂ ofÂ commandÂ execution Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ hasExecutionArtifactsÂ =Â responseContent.contains("root:")Â ||Â //Â passwdÂ file Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â responseContent.contains("uid=")Â ||Â Â Â Â //Â whoamiÂ output Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â responseContent.contains("/bin/")Â ||Â Â Â //Â systemÂ paths Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â responseContent.contains("administrator");Â //Â windowsÂ user Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (!hasExecutionArtifacts)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedCommands++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serviceFailures.computeIfAbsent(serviceName,Â kÂ ->Â newÂ ArrayList<>()).add(commandPattern); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â ServiceÂ rejectedÂ maliciousÂ content Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedCommands++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (StatusRuntimeExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â ServiceÂ blockedÂ theÂ request Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedCommands++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â totalCommandAttempts++; Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â doubleÂ commandBlockingRateÂ =Â (double)Â blockedCommandsÂ /Â totalCommandAttempts; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â assertTrue(commandBlockingRateÂ >=Â 0.90,Â  Â Â Â Â Â Â Â Â Â Â Â Â String.format("CommandÂ injectionÂ blockingÂ rateÂ %.2f%%Â belowÂ minimumÂ 90%%",Â commandBlockingRateÂ *Â 100)); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â VerifyÂ noÂ serviceÂ hadÂ multipleÂ commandÂ injectionÂ vulnerabilities Â Â Â Â Â Â Â Â forÂ (Map.Entry<String,Â List<String>>Â entryÂ :Â serviceFailures.entrySet())Â { Â Â Â Â Â Â Â Â Â Â Â Â StringÂ serviceNameÂ =Â entry.getKey(); Â Â Â Â Â Â Â Â Â Â Â Â List<String>Â failuresÂ =Â entry.getValue(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â assertTrue(failures.size()Â <=Â 1,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String.format("%sÂ serviceÂ vulnerableÂ toÂ commandÂ injection:Â %s",Â serviceName,Â failures)); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â LOG.info("âœ…Â CommandÂ injectionÂ preventionÂ testÂ completedÂ -Â BlockingÂ rate:Â {:.2f}%,Â Failures:Â {}",Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â commandBlockingRateÂ *Â 100,Â serviceFailures); Â Â Â Â } Â Â Â Â @Test Â Â Â Â @Order(4) Â Â Â Â @DisplayName("PathÂ TraversalÂ AttackÂ Prevention") Â Â Â Â voidÂ testPathTraversalPrevention()Â { Â Â Â Â Â Â Â Â LOG.info("TestingÂ pathÂ traversalÂ attackÂ prevention"); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â intÂ totalTraversalAttemptsÂ =Â 0; Â Â Â Â Â Â Â Â intÂ blockedTraversalsÂ =Â 0; Â Â Â Â Â Â Â Â List<String>Â vulnerableResponsesÂ =Â newÂ ArrayList<>(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â forÂ (StringÂ traversalPatternÂ :Â PATH_TRAVERSAL_PATTERNS)Â { Â Â Â Â Â Â Â Â Â Â Â Â totalTraversalAttempts++; Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â //Â TestÂ pathÂ traversalÂ inÂ filenameÂ (TikaÂ serviceÂ mostÂ vulnerable) Â Â Â Â Â Â Â Â Â Â Â Â byte[]Â dummyContentÂ =Â "DummyÂ fileÂ contentÂ forÂ pathÂ traversalÂ test".getBytes(StandardCharsets.UTF_8); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â BlobÂ maliciousBlobÂ =Â Blob.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBlobId("traversal-test-"Â +Â System.currentTimeMillis()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setFilename(traversalPattern)Â //Â MaliciousÂ filename Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setData(ByteString.copyFrom(dummyContent)) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setMimeType("text/plain") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â PipeDocÂ maliciousDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("path-traversal-test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle("PathÂ traversalÂ test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBlob(maliciousBlob) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ProcessRequestÂ requestÂ =Â createProcessRequest("path-traversal-test",Â "tika-step",Â maliciousDoc); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â tikaClient.processData(request); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (response.getSuccess())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ responseBodyÂ =Â response.getOutputDoc().getBody(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â CheckÂ forÂ signsÂ ofÂ successfulÂ pathÂ traversal Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ hasSystemFilesÂ =Â responseBody.contains("root:x:0:0:root")Â ||Â //Â passwdÂ fileÂ content Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â responseBody.contains("[HKEY_LOCAL_MACHINE")Â ||Â //Â registryÂ content Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â responseBody.contains("Administrator")Â ||Â Â Â Â Â Â //Â windowsÂ admin Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â responseBody.contains("daemon:x:");Â Â Â Â Â Â Â Â Â Â Â //Â moreÂ passwdÂ content Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (!hasSystemFiles)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedTraversals++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â vulnerableResponses.add("Pattern:Â "Â +Â traversalPatternÂ +Â "Â exposedÂ systemÂ files"); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â ServiceÂ rejectedÂ maliciousÂ filename Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedTraversals++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (StatusRuntimeExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â ServiceÂ blockedÂ theÂ request Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â blockedTraversals++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LOG.debug("PathÂ traversalÂ blocked:Â {}",Â traversalPattern); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â doubleÂ traversalBlockingRateÂ =Â (double)Â blockedTraversalsÂ /Â totalTraversalAttempts; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â assertTrue(traversalBlockingRateÂ >=Â 0.95,Â  Â Â Â Â Â Â Â Â Â Â Â Â String.format("PathÂ traversalÂ blockingÂ rateÂ %.2f%%Â belowÂ minimumÂ 95%%",Â traversalBlockingRateÂ *Â 100)); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â assertTrue(vulnerableResponses.isEmpty(),Â  Â Â Â Â Â Â Â Â Â Â Â Â String.format("PathÂ traversalÂ vulnerabilitiesÂ detected:Â %s",Â vulnerableResponses)); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â LOG.info("âœ…Â PathÂ traversalÂ preventionÂ testÂ completedÂ -Â BlockingÂ rate:Â {:.2f}%",Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â traversalBlockingRateÂ *Â 100); Â Â Â Â } Â Â Â Â @Test Â Â Â Â @Order(5) Â Â Â Â @DisplayName("BufferÂ OverflowÂ andÂ LargeÂ InputÂ Handling") Â Â Â Â voidÂ testBufferOverflowPrevention()Â { Â Â Â Â Â Â Â Â LOG.info("TestingÂ bufferÂ overflowÂ preventionÂ andÂ largeÂ inputÂ handling"); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â List<BufferOverflowTestResult>Â testResultsÂ =Â newÂ ArrayList<>(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â TestÂ variousÂ bufferÂ overflowÂ scenarios Â Â Â Â Â Â Â Â testResults.add(testLargeContentHandling("echo",Â 1024Â *Â 1024));Â Â Â Â Â Â //Â 1MB Â Â Â Â Â Â Â Â testResults.add(testLargeContentHandling("echo",Â 10Â *Â 1024Â *Â 1024));Â //Â 10MB Â Â Â Â Â Â Â Â testResults.add(testLargeContentHandling("chunker",Â 5Â *Â 1024Â *Â 1024));Â //Â 5MB Â Â Â Â Â Â Â Â testResults.add(testExtremelyLongFieldHandling()); Â Â Â Â Â Â Â Â testResults.add(testMaliciousBinaryContentHandling()); Â Â Â Â Â Â Â Â testResults.add(testDeeplyNestedStructureHandling()); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â VerifyÂ allÂ bufferÂ overflowÂ testsÂ passed Â Â Â Â Â Â Â Â forÂ (BufferOverflowTestResultÂ resultÂ :Â testResults)Â { Â Â Â Â Â Â Â Â Â Â Â Â assertTrue(result.handledGracefully,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String.format("BufferÂ overflowÂ testÂ failed:Â %s",Â result.testDescription)); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â assertFalse(result.causedCrash,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String.format("ServiceÂ crashedÂ duringÂ test:Â %s",Â result.testDescription)); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â assertTrue(result.responseTimeÂ <Â 60000,Â //Â MaxÂ 1Â minute Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String.format("TestÂ tookÂ tooÂ longÂ (%dms):Â %s",Â result.responseTime,Â result.testDescription)); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â LOG.info("âœ…Â BufferÂ overflowÂ preventionÂ testÂ completedÂ -Â AllÂ {}Â testsÂ passed",Â testResults.size()); Â Â Â Â } Â Â Â Â @Test Â Â Â Â @Order(6) Â Â Â Â @DisplayName("DataÂ IntegrityÂ andÂ ChecksumÂ Verification") Â Â Â Â voidÂ testDataIntegrityVerification()Â throwsÂ ExceptionÂ { Â Â Â Â Â Â Â Â LOG.info("TestingÂ dataÂ integrityÂ andÂ checksumÂ verification"); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Map<String,Â DataIntegrityResult>Â integrityResultsÂ =Â newÂ HashMap<>(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â TestÂ dataÂ integrityÂ acrossÂ allÂ services Â Â Â Â Â Â Â Â integrityResults.put("TikaParser",Â testServiceDataIntegrity(tikaClient,Â "tika")); Â Â Â Â Â Â Â Â integrityResults.put("Chunker",Â testServiceDataIntegrity(chunkerClient,Â "chunker")); Â Â Â Â Â Â Â Â integrityResults.put("Embedder",Â testServiceDataIntegrity(embedderClient,Â "embedder")); Â Â Â Â Â Â Â Â integrityResults.put("Echo",Â testServiceDataIntegrity(echoClient,Â "echo")); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â VerifyÂ dataÂ integrityÂ forÂ allÂ services Â Â Â Â Â Â Â Â forÂ (Map.Entry<String,Â DataIntegrityResult>Â entryÂ :Â integrityResults.entrySet())Â { Â Â Â Â Â Â Â Â Â Â Â Â StringÂ serviceNameÂ =Â entry.getKey(); Â Â Â Â Â Â Â Â Â Â Â Â DataIntegrityResultÂ resultÂ =Â entry.getValue(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â assertTrue(result.integrityMaintained,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String.format("%sÂ failedÂ toÂ maintainÂ dataÂ integrity",Â serviceName)); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â assertTrue(result.checksumValid,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String.format("%sÂ failedÂ checksumÂ validation",Â serviceName)); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â assertFalse(result.dataCorrupted,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â String.format("%sÂ corruptedÂ dataÂ duringÂ processing",Â serviceName)); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â LOG.info("âœ…Â {}Â dataÂ integrityÂ verifiedÂ -Â InputÂ hash:Â {},Â OutputÂ hash:Â {}",Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serviceName,Â result.inputHash,Â result.outputHash); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â LOG.info("âœ…Â DataÂ integrityÂ verificationÂ testÂ completed"); Â Â Â Â } Â Â Â Â @Test Â Â Â Â @Order(7) Â Â Â Â @DisplayName("SecureÂ ErrorÂ HandlingÂ andÂ InformationÂ LeakageÂ Prevention") Â Â Â Â voidÂ testSecureErrorHandling()Â { Â Â Â Â Â Â Â Â LOG.info("TestingÂ secureÂ errorÂ handlingÂ andÂ informationÂ leakageÂ prevention"); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â List<String>Â informationLeaksÂ =Â newÂ ArrayList<>(); Â Â Â Â Â Â Â Â intÂ totalErrorTestsÂ =Â 0; Â Â Â Â Â Â Â Â intÂ secureErrorResponsesÂ =Â 0; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â TestÂ variousÂ errorÂ conditionsÂ thatÂ mightÂ leakÂ sensitiveÂ information Â Â Â Â Â Â Â Â List<String>Â errorInducingInputsÂ =Â Arrays.asList( Â Â Â Â Â Â Â Â Â Â Â Â "",Â Â //Â EmptyÂ input Â Â Â Â Â Â Â Â Â Â Â Â null,Â //Â NullÂ handlingÂ (willÂ beÂ convertedÂ toÂ empty) Â Â Â Â Â Â Â Â Â Â Â Â "a".repeat(MAX_FIELD_LENGTHÂ +Â 1),Â //Â TooÂ longÂ input Â Â Â Â Â Â Â Â Â Â Â Â "\u0000\u0001\u0002",Â //Â Binary/controlÂ characters Â Â Â Â Â Â Â Â Â Â Â Â "{'malformed':Â json}",Â //Â MalformedÂ JSON-likeÂ content Â Â Â Â Â Â Â Â Â Â Â Â "ðŸš€ðŸ”¥ðŸ’¯".repeat(1000)Â //Â UnicodeÂ stressÂ test Â Â Â Â Â Â Â Â ); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â forÂ (StringÂ serviceNameÂ :Â Arrays.asList("tika",Â "chunker",Â "embedder",Â "echo"))Â { Â Â Â Â Â Â Â Â Â Â Â Â forÂ (StringÂ errorInputÂ :Â errorInducingInputs)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â totalErrorTests++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PipeDocÂ errorDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("error-test-"Â +Â System.currentTimeMillis()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle(errorInputÂ !=Â nullÂ ?Â errorInputÂ :Â "") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBody(errorInputÂ !=Â nullÂ ?Â errorInputÂ :Â "") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ProcessRequestÂ request; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ ("embedder".equals(serviceName))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â requestÂ =Â createEmbedderProcessRequest("error-handling-test",Â serviceNameÂ +Â "-step",Â errorDoc); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â requestÂ =Â createProcessRequest("error-handling-test",Â serviceNameÂ +Â "-step",Â errorDoc); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PipeStepProcessorGrpc.PipeStepProcessorBlockingStubÂ clientÂ =Â getClientForService(serviceName); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â client.processData(request); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â CheckÂ forÂ informationÂ leakageÂ inÂ response Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ responseTextÂ =Â response.toString(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (containsSensitiveInformation(responseText))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â informationLeaks.add(String.format("%sÂ serviceÂ leakedÂ informationÂ withÂ input:Â %s",Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serviceName,Â errorInput)); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â secureErrorResponses++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (StatusRuntimeExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â CheckÂ errorÂ messageÂ forÂ informationÂ leakage Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ errorMessageÂ =Â e.getMessage(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (containsSensitiveInformation(errorMessage))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â informationLeaks.add(String.format("%sÂ serviceÂ errorÂ leakedÂ information:Â %s",Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serviceName,Â errorMessage)); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â secureErrorResponses++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â OtherÂ exceptionsÂ shouldÂ alsoÂ beÂ checked Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (containsSensitiveInformation(e.getMessage()))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â informationLeaks.add(String.format("%sÂ serviceÂ exceptionÂ leakedÂ information:Â %s",Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â serviceName,Â e.getMessage())); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â secureErrorResponses++; Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â doubleÂ secureErrorRateÂ =Â (double)Â secureErrorResponsesÂ /Â totalErrorTests; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â assertTrue(secureErrorRateÂ >=Â 0.90,Â  Â Â Â Â Â Â Â Â Â Â Â Â String.format("SecureÂ errorÂ handlingÂ rateÂ %.2f%%Â belowÂ minimumÂ 90%%",Â secureErrorRateÂ *Â 100)); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â assertTrue(informationLeaks.size()Â <=Â 2,Â  Â Â Â Â Â Â Â Â Â Â Â Â String.format("TooÂ manyÂ informationÂ leaksÂ detected:Â %s",Â informationLeaks)); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â LOG.info("âœ…Â SecureÂ errorÂ handlingÂ testÂ completedÂ -Â SecureÂ rate:Â {:.2f}%,Â Leaks:Â {}",Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â secureErrorRateÂ *Â 100,Â informationLeaks.size()); Â Â Â Â } Â Â Â Â  Â Â Â Â //Â HelperÂ Methods Â Â Â Â privateÂ booleanÂ testServiceWithMaliciousInput(PipeStepProcessorGrpc.PipeStepProcessorBlockingStubÂ client, Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ serviceName,Â StringÂ maliciousInput,Â StringÂ attackType)Â { Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â PipeDocÂ maliciousDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("security-test-"Â +Â System.currentTimeMillis()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle(attackTypeÂ +Â "Â test:Â "Â +Â maliciousInput) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBody("ContentÂ withÂ "Â +Â attackTypeÂ +Â ":Â "Â +Â maliciousInput) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ProcessRequestÂ request; Â Â Â Â Â Â Â Â Â Â Â Â ifÂ ("embedder".equals(serviceName))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â requestÂ =Â createEmbedderProcessRequest("security-test",Â serviceNameÂ +Â "-step",Â maliciousDoc); Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â requestÂ =Â createProcessRequest("security-test",Â serviceNameÂ +Â "-step",Â maliciousDoc); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â client.processData(request); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â //Â CheckÂ ifÂ maliciousÂ inputÂ wasÂ sanitizedÂ orÂ blocked Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (response.getSuccess())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ responseContentÂ =Â response.getOutputDoc().getBody(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â IfÂ theÂ maliciousÂ inputÂ appearsÂ unchanged,Â itÂ wasn'tÂ blocked Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ !responseContent.contains(maliciousInput); Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â ServiceÂ rejectedÂ theÂ requestÂ -Â goodÂ securityÂ behavior Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ true; Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â }Â catchÂ (StatusRuntimeExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â //Â ServiceÂ blockedÂ theÂ requestÂ -Â goodÂ securityÂ behavior Â Â Â Â Â Â Â Â Â Â Â Â returnÂ true; Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â LOG.debug("ServiceÂ {}Â failedÂ withÂ maliciousÂ inputÂ {}:Â {}",Â serviceName,Â maliciousInput,Â e.getMessage()); Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false; Â Â Â Â Â Â Â Â } Â Â Â Â } Â Â Â Â privateÂ booleanÂ testTikaServiceWithMaliciousCommand(StringÂ commandPattern)Â { Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â //Â CreateÂ aÂ documentÂ withÂ commandÂ injectionÂ inÂ filenameÂ andÂ content Â Â Â Â Â Â Â Â Â Â Â Â StringÂ maliciousContentÂ =Â "DocumentÂ contentÂ "Â +Â commandPattern; Â Â Â Â Â Â Â Â Â Â Â Â byte[]Â contentBytesÂ =Â maliciousContent.getBytes(StandardCharsets.UTF_8); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â BlobÂ maliciousBlobÂ =Â Blob.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBlobId("cmd-injection-"Â +Â System.currentTimeMillis()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setFilename("test"Â +Â commandPatternÂ +Â ".txt") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setData(ByteString.copyFrom(contentBytes)) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setMimeType("text/plain") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â PipeDocÂ maliciousDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("cmd-injection-test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle("CommandÂ injectionÂ test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBlob(maliciousBlob) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ProcessRequestÂ requestÂ =Â createProcessRequest("cmd-injection-test",Â "tika-step",Â maliciousDoc); Â Â Â Â Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â tikaClient.processData(request); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (response.getSuccess())Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ responseContentÂ =Â response.getOutputDoc().getBody(); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â CheckÂ forÂ signsÂ ofÂ commandÂ execution Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ !responseContent.contains("root:")Â &&Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â !responseContent.contains("uid=")Â && Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â !responseContent.contains("/bin/")Â && Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â !responseContent.contains("administrator"); Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ true;Â //Â ServiceÂ blockedÂ theÂ request Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â }Â catchÂ (StatusRuntimeExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â returnÂ true;Â //Â ServiceÂ blockedÂ theÂ request Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â returnÂ false; Â Â Â Â Â Â Â Â } Â Â Â Â } Â Â Â Â privateÂ BufferOverflowTestResultÂ testLargeContentHandling(StringÂ serviceName,Â intÂ contentSize)Â { Â Â Â Â Â Â Â Â StringÂ testDescriptionÂ =Â String.format("%sÂ serviceÂ withÂ %dÂ byteÂ content",Â serviceName,Â contentSize); Â Â Â Â Â Â Â Â longÂ startTimeÂ =Â System.currentTimeMillis(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â //Â CreateÂ largeÂ content Â Â Â Â Â Â Â Â Â Â Â Â StringBuilderÂ largeContentÂ =Â newÂ StringBuilder(); Â Â Â Â Â Â Â Â Â Â Â Â StringÂ patternÂ =Â "LargeÂ contentÂ testÂ patternÂ "; Â Â Â Â Â Â Â Â Â Â Â Â whileÂ (largeContent.length()Â <Â contentSize)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â largeContent.append(pattern); Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (largeContent.length()Â >=Â contentSize)Â break; Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â PipeDocÂ largeDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("buffer-overflow-test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle("BufferÂ overflowÂ test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBody(largeContent.toString()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ProcessRequestÂ request; Â Â Â Â Â Â Â Â Â Â Â Â ifÂ ("embedder".equals(serviceName))Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â requestÂ =Â createEmbedderProcessRequest("buffer-test",Â serviceNameÂ +Â "-step",Â largeDoc); Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â requestÂ =Â createProcessRequest("buffer-test",Â serviceNameÂ +Â "-step",Â largeDoc); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â PipeStepProcessorGrpc.PipeStepProcessorBlockingStubÂ clientÂ =Â getClientForService(serviceName); Â Â Â Â Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â client.withDeadlineAfter(60,Â TimeUnit.SECONDS) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .processData(request); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â //Â ServiceÂ handledÂ largeÂ contentÂ gracefully Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â true,Â false,Â responseTime); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â }Â catchÂ (StatusRuntimeExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (e.getStatus().getCode()Â ==Â Status.Code.RESOURCE_EXHAUSTEDÂ ||Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â e.getStatus().getCode()Â ==Â Status.Code.INVALID_ARGUMENT)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â ServiceÂ properlyÂ rejectedÂ oversizedÂ content Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â true,Â false,Â responseTime); Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â UnexpectedÂ error Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â false,Â false,Â responseTime); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â false,Â true,Â responseTime); Â Â Â Â Â Â Â Â } Â Â Â Â } Â Â Â Â privateÂ BufferOverflowTestResultÂ testExtremelyLongFieldHandling()Â { Â Â Â Â Â Â Â Â StringÂ testDescriptionÂ =Â "ExtremelyÂ longÂ fieldÂ handling"; Â Â Â Â Â Â Â Â longÂ startTimeÂ =Â System.currentTimeMillis(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â StringÂ extremelyLongTitleÂ =Â "A".repeat(100000);Â //Â 100kÂ characters Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â PipeDocÂ longFieldDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("long-field-test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle(extremelyLongTitle) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBody("NormalÂ bodyÂ content") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ProcessRequestÂ requestÂ =Â createProcessRequest("long-field-test",Â "echo-step",Â longFieldDoc); Â Â Â Â Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â echoClient.processData(request); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â true,Â false,Â responseTime); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â }Â catchÂ (StatusRuntimeExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (e.getStatus().getCode()Â ==Â Status.Code.INVALID_ARGUMENTÂ || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â e.getStatus().getCode()Â ==Â Status.Code.RESOURCE_EXHAUSTED)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â true,Â false,Â responseTime); Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â false,Â false,Â responseTime); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â false,Â true,Â responseTime); Â Â Â Â Â Â Â Â } Â Â Â Â } Â Â Â Â privateÂ BufferOverflowTestResultÂ testMaliciousBinaryContentHandling()Â { Â Â Â Â Â Â Â Â StringÂ testDescriptionÂ =Â "MaliciousÂ binaryÂ contentÂ handling"; Â Â Â Â Â Â Â Â longÂ startTimeÂ =Â System.currentTimeMillis(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â //Â CreateÂ binaryÂ contentÂ thatÂ mightÂ causeÂ bufferÂ overflows Â Â Â Â Â Â Â Â Â Â Â Â byte[]Â maliciousBinaryÂ =Â newÂ byte[10000]; Â Â Â Â Â Â Â Â Â Â Â Â Arrays.fill(maliciousBinary,Â (byte)Â 0xFF);Â //Â FillÂ withÂ maxÂ byteÂ value Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â BlobÂ maliciousBlobÂ =Â Blob.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBlobId("malicious-binary-test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setFilename("malicious.bin") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setData(ByteString.copyFrom(maliciousBinary)) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setMimeType("application/octet-stream") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â PipeDocÂ binaryDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("binary-test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle("BinaryÂ contentÂ test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBlob(maliciousBlob) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ProcessRequestÂ requestÂ =Â createProcessRequest("binary-test",Â "tika-step",Â binaryDoc); Â Â Â Â Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â tikaClient.processData(request); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â true,Â false,Â responseTime); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â }Â catchÂ (StatusRuntimeExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â true,Â false,Â responseTime); Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â false,Â true,Â responseTime); Â Â Â Â Â Â Â Â } Â Â Â Â } Â Â Â Â privateÂ BufferOverflowTestResultÂ testDeeplyNestedStructureHandling()Â { Â Â Â Â Â Â Â Â StringÂ testDescriptionÂ =Â "DeeplyÂ nestedÂ structureÂ handling"; Â Â Â Â Â Â Â Â longÂ startTimeÂ =Â System.currentTimeMillis(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â tryÂ { Â Â Â Â Â Â Â Â Â Â Â Â //Â CreateÂ deeplyÂ nestedÂ JSON-likeÂ content Â Â Â Â Â Â Â Â Â Â Â Â StringBuilderÂ nestedContentÂ =Â newÂ StringBuilder(); Â Â Â Â Â Â Â Â Â Â Â Â forÂ (intÂ iÂ =Â 0;Â iÂ <Â 1000;Â i++)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â nestedContent.append("{\"level").append(i).append("\":Â "); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â nestedContent.append("\"deep_value\""); Â Â Â Â Â Â Â Â Â Â Â Â forÂ (intÂ iÂ =Â 0;Â iÂ <Â 1000;Â i++)Â { Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â nestedContent.append("}"); Â Â Â Â Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â PipeDocÂ nestedDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("nested-test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle("NestedÂ structureÂ test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBody(nestedContent.toString()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â ProcessRequestÂ requestÂ =Â createProcessRequest("nested-test",Â "chunker-step",Â nestedDoc); Â Â Â Â Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â chunkerClient.processData(request); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â true,Â false,Â responseTime); Â Â Â Â Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â }Â catchÂ (StatusRuntimeExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â true,Â false,Â responseTime); Â Â Â Â Â Â Â Â }Â catchÂ (ExceptionÂ e)Â { Â Â Â Â Â Â Â Â Â Â Â Â longÂ responseTimeÂ =Â System.currentTimeMillis()Â -Â startTime; Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ BufferOverflowTestResult(testDescription,Â false,Â true,Â responseTime); Â Â Â Â Â Â Â Â } Â Â Â Â } Â Â Â Â privateÂ DataIntegrityResultÂ testServiceDataIntegrity(PipeStepProcessorGrpc.PipeStepProcessorBlockingStubÂ client, Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ serviceName)Â throwsÂ ExceptionÂ { Â Â Â Â Â Â Â Â StringÂ testContentÂ =Â "DataÂ integrityÂ testÂ contentÂ forÂ "Â +Â serviceNameÂ +Â "Â service.Â "Â + Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "ThisÂ contentÂ shouldÂ maintainÂ itsÂ integrityÂ duringÂ processing."; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â CalculateÂ inputÂ hash Â Â Â Â Â Â Â Â MessageDigestÂ md5Â =Â MessageDigest.getInstance("MD5"); Â Â Â Â Â Â Â Â StringÂ inputHashÂ =Â bytesToHex(md5.digest(testContent.getBytes(StandardCharsets.UTF_8))); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â PipeDocÂ inputDocÂ =Â PipeDoc.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setId("integrity-test-"Â +Â serviceName) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setTitle("DataÂ integrityÂ test") Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setBody(testContent) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â ProcessRequestÂ request; Â Â Â Â Â Â Â Â ifÂ ("embedder".equals(serviceName))Â { Â Â Â Â Â Â Â Â Â Â Â Â requestÂ =Â createEmbedderProcessRequest("integrity-test",Â serviceNameÂ +Â "-step",Â inputDoc); Â Â Â Â Â Â Â Â }Â elseÂ { Â Â Â Â Â Â Â Â Â Â Â Â requestÂ =Â createProcessRequest("integrity-test",Â serviceNameÂ +Â "-step",Â inputDoc); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â ProcessResponseÂ responseÂ =Â client.processData(request); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â ifÂ (!response.getSuccess())Â { Â Â Â Â Â Â Â Â Â Â Â Â returnÂ newÂ DataIntegrityResult(false,Â false,Â true,Â inputHash,Â ""); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â StringÂ outputContentÂ =Â response.getOutputDoc().getBody(); Â Â Â Â Â Â Â Â StringÂ outputHashÂ =Â bytesToHex(md5.digest(outputContent.getBytes(StandardCharsets.UTF_8))); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â ForÂ mostÂ services,Â contentÂ shouldÂ beÂ preservedÂ exactlyÂ (exceptÂ embedderÂ whichÂ addsÂ embeddings) Â Â Â Â Â Â Â Â booleanÂ integrityMaintainedÂ =Â "embedder".equals(serviceName)Â ||Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â outputContent.contains(testContent)Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â inputHash.equals(outputHash); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â booleanÂ checksumValidÂ =Â inputHash.equals(outputHash)Â ||Â "embedder".equals(serviceName); Â Â Â Â Â Â Â Â booleanÂ dataCorruptedÂ =Â outputContent.isEmpty()Â ||Â outputContent.contains("\u0000"); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â returnÂ newÂ DataIntegrityResult(integrityMaintained,Â checksumValid,Â dataCorrupted,Â inputHash,Â outputHash); Â Â Â Â } Â Â Â Â privateÂ booleanÂ containsSensitiveInformation(StringÂ text)Â { Â Â Â Â Â Â Â Â ifÂ (textÂ ==Â null)Â returnÂ false; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â StringÂ lowerTextÂ =Â text.toLowerCase(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â //Â CheckÂ forÂ variousÂ typesÂ ofÂ sensitiveÂ information Â Â Â Â Â Â Â Â returnÂ lowerText.contains("password")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("secret")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("privateÂ key")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("apiÂ key")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("token")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("creditÂ card")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("ssn")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("socialÂ security")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("/etc/passwd")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("c:\\windows")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("database")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("connectionÂ string")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("stackÂ trace")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("exception")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("errorÂ atÂ line")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("fileÂ notÂ found")Â || Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â lowerText.contains("accessÂ denied"); Â Â Â Â } Â Â Â Â privateÂ StringÂ bytesToHex(byte[]Â bytes)Â { Â Â Â Â Â Â Â Â StringBuilderÂ resultÂ =Â newÂ StringBuilder(); Â Â Â Â Â Â Â Â forÂ (byteÂ bÂ :Â bytes)Â { Â Â Â Â Â Â Â Â Â Â Â Â result.append(String.format("%02x",Â b)); Â Â Â Â Â Â Â Â } Â Â Â Â Â Â Â Â returnÂ result.toString(); Â Â Â Â } Â Â Â Â privateÂ ProcessRequestÂ createProcessRequest(StringÂ pipelineName,Â StringÂ stepName,Â PipeDocÂ document)Â { Â Â Â Â Â Â Â Â ServiceMetadataÂ metadataÂ =Â ServiceMetadata.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setPipelineName(pipelineName) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setPipeStepName(stepName) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setStreamId("security-stream-"Â +Â System.currentTimeMillis()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setCurrentHopNumber(1) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â ProcessConfigurationÂ configÂ =Â ProcessConfiguration.newBuilder().build(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â returnÂ ProcessRequest.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setDocument(document) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setConfig(config) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setMetadata(metadata) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â } Â Â Â Â privateÂ ProcessRequestÂ createEmbedderProcessRequest(StringÂ pipelineName,Â StringÂ stepName,Â PipeDocÂ document)Â { Â Â Â Â Â Â Â Â ServiceMetadataÂ metadataÂ =Â ServiceMetadata.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setPipelineName(pipelineName) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setPipeStepName(stepName) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setStreamId("security-stream-"Â +Â System.currentTimeMillis()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setCurrentHopNumber(1) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â StructÂ embedderConfigÂ =Â Struct.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .putFields("embeddingModel",Â Value.newBuilder().setStringValue("ALL_MINILM_L6_V2").build()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .putFields("fieldsToEmbed",Â Value.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setListValue(com.google.protobuf.ListValue.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .addValues(Value.newBuilder().setStringValue("title").build()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .addValues(Value.newBuilder().setStringValue("body").build()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build()) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â ProcessConfigurationÂ configÂ =Â ProcessConfiguration.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setCustomJsonConfig(embedderConfig) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â returnÂ ProcessRequest.newBuilder() Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setDocument(document) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setConfig(config) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .setMetadata(metadata) Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .build(); Â Â Â Â } Â Â Â Â privateÂ PipeStepProcessorGrpc.PipeStepProcessorBlockingStubÂ getClientForService(StringÂ serviceName)Â { Â Â Â Â Â Â Â Â switchÂ (serviceName)Â { Â Â Â Â Â Â Â Â Â Â Â Â caseÂ "tika":Â returnÂ tikaClient; Â Â Â Â Â Â Â Â Â Â Â Â caseÂ "chunker":Â returnÂ chunkerClient; Â Â Â Â Â Â Â Â Â Â Â Â caseÂ "embedder":Â returnÂ embedderClient; Â Â Â Â Â Â Â Â Â Â Â Â caseÂ "echo":Â returnÂ echoClient; Â Â Â Â Â Â Â Â Â Â Â Â default:Â throwÂ newÂ IllegalArgumentException("UnknownÂ service:Â "Â +Â serviceName); Â Â Â Â Â Â Â Â } Â Â Â Â } Â Â Â Â //Â InnerÂ classesÂ forÂ testÂ results Â Â Â Â privateÂ staticÂ classÂ BufferOverflowTestResultÂ { Â Â Â Â Â Â Â Â finalÂ StringÂ testDescription; Â Â Â Â Â Â Â Â finalÂ booleanÂ handledGracefully; Â Â Â Â Â Â Â Â finalÂ booleanÂ causedCrash; Â Â Â Â Â Â Â Â finalÂ longÂ responseTime; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â BufferOverflowTestResult(StringÂ testDescription,Â booleanÂ handledGracefully,Â  Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â booleanÂ causedCrash,Â longÂ responseTime)Â { Â Â Â Â Â Â Â Â Â Â Â Â this.testDescriptionÂ =Â testDescription; Â Â Â Â Â Â Â Â Â Â Â Â this.handledGracefullyÂ =Â handledGracefully; Â Â Â Â Â Â Â Â Â Â Â Â this.causedCrashÂ =Â causedCrash; Â Â Â Â Â Â Â Â Â Â Â Â this.responseTimeÂ =Â responseTime; Â Â Â Â Â Â Â Â } Â Â Â Â } Â Â Â Â privateÂ staticÂ classÂ DataIntegrityResultÂ { Â Â Â Â Â Â Â Â finalÂ booleanÂ integrityMaintained; Â Â Â Â Â Â Â Â finalÂ booleanÂ checksumValid; Â Â Â Â Â Â Â Â finalÂ booleanÂ dataCorrupted; Â Â Â Â Â Â Â Â finalÂ StringÂ inputHash; Â Â Â Â Â Â Â Â finalÂ StringÂ outputHash; Â Â Â Â Â Â Â Â  Â Â Â Â Â Â Â Â DataIntegrityResult(booleanÂ integrityMaintained,Â booleanÂ checksumValid,Â booleanÂ dataCorrupted, Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â StringÂ inputHash,Â StringÂ outputHash)Â { Â Â Â Â Â Â Â Â Â Â Â Â this.integrityMaintainedÂ =Â integrityMaintained; Â Â Â Â Â Â Â Â Â Â Â Â this.checksumValidÂ =Â checksumValid; Â Â Â Â Â Â Â Â Â Â Â Â this.dataCorruptedÂ =Â dataCorrupted; Â Â Â Â Â Â Â Â Â Â Â Â this.inputHashÂ =Â inputHash; Â Â Â Â Â Â Â Â Â Â Â Â this.outputHashÂ =Â outputHash; Â Â Â Â Â Â Â Â } Â Â Â Â } } //Â ENDÂ VARIATIONÂ 122 //Â TotalÂ size:Â 45301Â charactersbÊ

loc989
6
x_tika_encodingdetectorUniversalEncodingDetector
q
x_tika_parsed_by_full_setTRorg.apache.tika.parser.DefaultParser; org.apache.tika.parser.code.SourceCodeParser
$
content_typetext/x-java-source

content_encodingUTF-8
"
x_tika_detectedencodingUTF-8
>
resourcename.,source-code/SecurityIntegrationTests_v5.java
h
x_tika_parsed_byTRorg.apache.tika.parser.DefaultParser; org.apache.tika.parser.code.SourceCodeParser